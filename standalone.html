<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Onboarding for Prompt Engineers</title>
  <link type="image/png" sizes="16x16" rel="icon" href="https://i.postimg.cc/gJf9MgWR/icons8-32.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <!-- –°—Ç–∏–ª–∏ –∏–∑ —Ñ–∞–π–ª–∞ css/style.css -->
  <style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞ */
    :root {
      --primary-color: #4a6baf;
      --primary-hover: #3a5b9f;
      --secondary-color: #6c757d;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --light-color: #f8f9fa;
      --dark-color: #343a40;
      --background-color: #f5f7fa;
      --card-bg: #ffffff;
      --border-radius: 8px;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --font-family: 'Roboto', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--background-color);
      color: #333;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      transition: all 0.3s ease;
    }

    header {
      background: var(--primary-color);
      color: white;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
    .course-card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      margin-bottom: 20px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      border-left: 4px solid var(--primary-color);
    }

    .course-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .course-card h3 {
      color: var(--primary-color);
      margin-top: 0;
      font-size: 1.4rem;
    }

    .course-card p {
      color: var(--secondary-color);
      margin-bottom: 10px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: background-color 0.3s ease, transform 0.2s ease;
      margin: 5px 0;
      display: block;
      width: 100%;
      text-align: left;
    }

    button:hover {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ */
    .section {
      padding: 20px;
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      margin-bottom: 20px;
    }

    .section h2 {
      color: var(--primary-color);
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 10px;
      margin-top: 0;
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    .navigation {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .back-button {
      background-color: var(--secondary-color);
      max-width: 150px;
    }

    .back-button:hover {
      background-color: #5a6268;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–Ω–µ–π */
    .content-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—ã–±–æ—Ä–∞ —É—Ä–æ–∫–æ–≤ */
    #task-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* Markdown –∫–æ–Ω—Ç–µ–Ω—Ç */
    #markdown-content {
      background-color: var(--card-bg);
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      line-height: 1.8;
    }

    #markdown-content h1, 
    #markdown-content h2,
    #markdown-content h3 {
      color: var(--primary-color);
    }

    #markdown-content h1 {
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 10px;
      margin-top: 0;
    }

    #markdown-content blockquote {
      border-left: 4px solid var(--primary-color);
      padding-left: 15px;
      color: var(--secondary-color);
      font-style: italic;
    }

    #markdown-content code {
      background-color: #f5f5f5;
      padding: 2px 4px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }

    #markdown-content pre code {
      display: block;
      padding: 15px;
      overflow-x: auto;
      background-color: #f8f9fa;
      border-radius: var(--border-radius);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    @media (max-width: 768px) {
      .content-cards {
        grid-template-columns: 1fr;
      }

      button {
        padding: 12px 15px;
      }

      #markdown-content {
        padding: 15px;
      }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ */
    .loading-container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 30px;
    }

    .loading-spinner {
      border: 5px solid rgba(0, 0, 0, 0.1);
      border-top: 5px solid var(--primary-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-status {
      margin-top: 15px;
      font-size: 14px;
      color: var(--secondary-color);
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è */
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
    #global-loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 9999;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Ç–µ—Å—Ç–∞ */
    #test-button {
      background-color: var(--success-color);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin: 20px auto;
      width: auto;
      max-width: 200px;
    }

    #test-button:hover {
      background-color: #218838;
    }

    /* –≠—Ñ—Ñ–µ–∫—Ç –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    .hidden {
      display: none !important;
    }

    /* –ü–æ–ø—Ä–∞–≤–∫–∞ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
    select {
      padding: 10px;
      border-radius: var(--border-radius);
      border: 1px solid #ced4da;
      background-color: white;
      font-size: 16px;
      margin-bottom: 15px;
      width: 100%;
    }

    /* Added styles for collapsible blocks */
    details > summary {
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      padding: 10px 0;
      outline: none;
      transition: color 0.2s;
    }
    details details > summary {
      font-size: 0.9em;
      font-weight: bold;
      margin-left: 5px;
    }
    details details details > summary {
      font-size: 0.8em;
      font-weight: bold;
      margin-left: 10px;
    }
    details {
      background: #fff;
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    details[open] > summary {
      margin-bottom: 10px;
      color: #3498db;
    }
  </style>
</head>
  <body>
    <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="global-loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.9); z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center;">
      <div class="spinner" style="width: 80px; height: 80px; border-width: 8px;"></div>
      <h2 style="color: #3498db; margin-top: 20px;">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...</h2>
      <p id="global-loading-status" style="font-size: 16px; margin-top: 15px;">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö...</p>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading-spinner" class="container center" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #f8f8f8; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;">
      <div class="spinner" style="width: 80px; height: 80px; border-width: 8px;"></div>
      <h2 style="color: #3498db; margin-top: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤...</h2>
      <p class="loading-status" style="font-size: 16px; margin-top: 15px;">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</p>
      <div id="loading-retry-container" class="hidden" style="margin-top: 20px; background-color: #ffeeee; padding: 15px; border-radius: 5px; border-left: 4px solid #ff5555;">
        <p style="font-weight: bold; color: #cc0000;">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º.</p>
        <button onclick="location.reload()" style="background-color: #ff5555; margin-top: 10px;">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
        <p style="font-size: 14px; margin-top: 10px; color: #666;">–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</p>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div id="app-content" class="hidden">
      <!-- –î–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
      <div id="home" class="container center">
        <div id="day-selection">
          <h1>Learning Platform</h1>
          <p>
            Course:&nbsp;
            <select id="profession-select" onchange="handleProfessionChange()">
              <option value="">Select a course</option>
            </select>
          </p>

          <div style="margin: 30px 0;">
            <p>Quick Reference:</p>
            <div id="vocabulary-container">
              <!-- Vocabulary buttons will be dynamically added here -->
            </div>
          </div>

          <div style="margin-top: 30px;">
            <p>Select Training Day:</p>
            <div id="days-container">
              <!-- Day buttons will be dynamically added here -->
            </div>
          </div>

          <div id="admin-access" style="margin-top: 30px;">
            <a href="admin.html" style="text-decoration: none;">
              <button style="background-color: #3498db;">Course Management</button>
            </a>
          </div>
        </div>
        <div id="task-selection" class="hidden">
          <h1 id="day-header"></h1>
          <div id="task-buttons" class="task-buttons"></div>
          <button onclick="goBackToDaySelection()">Back</button>
        </div>
      </div>

      <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–∞–π–¥–∞ -->
      <div id="guide" class="container hidden">
        <h1 id="guide-title">Guide:</h1>
        <div id="content-loading-spinner" class="center hidden">
          <div class="spinner"></div>
          <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ...</p>
        </div>

        <!-- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∞—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∞—É–¥–∏–æ -->
        <div id="audio-embed" class="hidden center audio-container" style="margin-bottom: 20px; max-width: 100%; width: 100%; display: flex; flex-direction: column; align-items: center;">
          <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ JS -->
        </div>

        <!-- –°–∫—Ä—ã—Ç—ã–µ –∞—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ -->
        <div id="audio-first-lesson" class="hidden"></div>
        <div id="audio-vocabulary" class="hidden"></div>

        <!-- –†–µ–∑–µ—Ä–≤–Ω—ã–π –∞—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä—è–º—ã—Ö URL -->
        <div id="audio-fallback" class="hidden center audio-container" style="margin-bottom: 20px; max-width: 100%; width: 100%;">
          <audio controls style="width:100%; max-width:600px;">
            <source src="" type="audio/mpeg" id="audio-fallback-source">
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
          </audio>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Markdown –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
        <div id="markdown-content" class="markdown-content hidden"></div>

        <!-- –ö–Ω–æ–ø–∫–∞ Test –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è -->
        <div class="center" style="margin-top:20px;">
          <button id="test-button" onclick="window.location.href = currentTopic.testWebhook">Test</button>
        </div>
        <!-- –ö–Ω–æ–ø–∫–∞ Back –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å–ø–∏—Å–∫—É —Ç–æ–ø–∏–∫–æ–≤ -->
        <div class="center" style="margin-top:20px;">
          <button onclick="goBackToTaskSelection()">Back</button>
        </div>
      </div>
    </div>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <style>
      /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
      #loading-spinner .spinner {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #3498db;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1.5s linear infinite;
        margin: 0 auto 20px auto;
      }

      #loading-spinner p {
        margin: 10px 0;
        font-size: 18px;
        color: #333;
      }

      .loading-status {
        font-size: 14px !important;
        color: #666 !important;
        margin-top: 5px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </body>
  <script>
  // ==================== BEGIN COURSE MANAGER CODE ====================
  /**
   * Course Manager Module
   * –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∫—É—Ä—Å–æ–≤
   */
  class CourseManager {
    constructor() {
      this.courses = null;
      this.fallbacks = null;
      this.currentProfession = "prompt-engineer";
      this.currentDay = null;
      this.currentLesson = null;
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä –∫—É—Ä—Å–æ–≤
     */
    async initialize() {
      try {
        console.log('CourseManager: –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...');
        console.log('CourseManager: –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:', new Date().toISOString());

        // –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤
        this.courseUpdateCallbacks = [];

        // –í—ã–≤–æ–¥–∏–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
        console.log('CourseManager: –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ courses:', this.courses ? Object.keys(this.courses) : 'null');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        if (this.courses && Object.keys(this.courses).length > 0) {
          console.log('CourseManager: –î–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –Ω–∏–º–∏');
          console.log('CourseManager: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–π:', Object.keys(this.courses).length);
          console.log('CourseManager: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–π:', Object.keys(this.courses).join(', '));

          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö - –Ω–∞–ª–∏—á–∏–µ –¥–Ω–µ–π –∏ —É—Ä–æ–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
          let dataIsValid = true;
          for (const profId of Object.keys(this.courses)) {
            const course = this.courses[profId];

            // –ï—Å–ª–∏ —ç—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç, —Ç–æ –¥–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã
            if (course.redirectUrl) {
              console.log(`CourseManager: –ü—Ä–æ—Ñ–µ—Å—Å–∏—è ${profId} –∏–º–µ–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∞–ª–∏–¥–Ω–∞`);
              continue;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–Ω–µ–π –¥–ª—è —ç—Ç–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
            if (!course.days || !Array.isArray(course.days) || course.days.length === 0) {
              console.warn(`CourseManager: –ü—Ä–æ—Ñ–µ—Å—Å–∏—è ${profId} –Ω–µ –∏–º–µ–µ—Ç –¥–Ω–µ–π –æ–±—É—á–µ–Ω–∏—è!`);
              dataIsValid = false;
            } else {
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —É—Ä–æ–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
              course.days.forEach((day, idx) => {
                if (!day.lessons || !Array.isArray(day.lessons) || day.lessons.length === 0) {
                  console.warn(`CourseManager: –î–µ–Ω—å ${idx + 1} –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ${profId} –Ω–µ –∏–º–µ–µ—Ç —É—Ä–æ–∫–æ–≤!`);
                  dataIsValid = false;
                } else {
                  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ contentSource –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞
                  const firstLesson = day.lessons[0];
                  if (!firstLesson.contentSource) {
                    console.warn(`CourseManager: –ü–µ—Ä–≤—ã–π —É—Ä–æ–∫ –≤ –¥–Ω–µ ${idx + 1} –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ${profId} –Ω–µ –∏–º–µ–µ—Ç contentSource!`);
                    dataIsValid = false;
                  }
                }
              });
            }
          }

          if (dataIsValid) {
            console.log('CourseManager: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–∞, –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã');
            // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ–± –∏–º–µ—é—â–∏—Ö—Å—è –∫—É—Ä—Å–∞—Ö
            this.notifyCoursesUpdated();
            return true;
          } else {
            console.warn('CourseManager: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞');
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
          }
        }

        console.log('CourseManager: –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –Ω–∞—á–∏–Ω–∞—é –∑–∞–≥—Ä—É–∑–∫—É...');

        // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –∏–∑ localStorage
        let importWebhookUrl = null;
        const adminWebhookUrl = localStorage.getItem('adminImportWebhook');
        if (adminWebhookUrl) {
          importWebhookUrl = adminWebhookUrl;
          console.log(`CourseManager: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è URL –∏–∑ adminImportWebhook: ${importWebhookUrl}`);
        } else {
          const webhookSettingsStr = localStorage.getItem('webhookSettings');
          if (webhookSettingsStr) {
            try {
              const webhookSettings = JSON.parse(webhookSettingsStr);
              if (webhookSettings.importUrl) {
                importWebhookUrl = webhookSettings.importUrl;
                console.log(`CourseManager: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è URL –∏–∑ webhookSettings: ${importWebhookUrl}`);
              }
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤:', e);
            }
          }
        }
        if (!importWebhookUrl) {
          importWebhookUrl = localStorage.getItem('importWebhookUrl');
          if (importWebhookUrl) {
            console.log(`CourseManager: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è URL –∏–∑ importWebhookUrl: ${importWebhookUrl}`);
          }
        }
        if (!importWebhookUrl) {
          importWebhookUrl = localStorage.getItem('testImportUrl');
          if (importWebhookUrl) {
            console.log(`CourseManager: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è URL –∏–∑ testImportUrl: ${importWebhookUrl}`);
          }
        }

        if (window.devMode && window.devMode.enabled) {
          console.log('üîß [DevMode] –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ CourseManager');
          if (importWebhookUrl) {
            console.log(`üîß [DevMode] –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤–µ–±—Ö—É–∫ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞: ${importWebhookUrl}`);
          } else {
            console.log('üîß [DevMode] URL –≤–µ–±—Ö—É–∫–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª');
          }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –≤–µ–±—Ö—É–∫–∞
        try {
          let webhookUrl = importWebhookUrl;
          if (!webhookUrl) {
            const webhookSettings = localStorage.getItem('webhookSettings');
            const adminWebhookUrl = localStorage.getItem('adminImportWebhook');
            const testImportUrl = localStorage.getItem('testImportUrl');
            if (adminWebhookUrl) {
              webhookUrl = adminWebhookUrl;
              console.log(`–ù–∞–π–¥–µ–Ω URL –∏–º–ø–æ—Ä—Ç–∞ –≤ adminImportWebhook: ${webhookUrl}`);
            } else if (webhookSettings) {
              try {
                const settings = JSON.parse(webhookSettings);
                if (settings.importUrl) {
                  webhookUrl = settings.importUrl;
                  console.log(`–ù–∞–π–¥–µ–Ω URL –∏–º–ø–æ—Ä—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–µ–±—Ö—É–∫–æ–≤: ${webhookUrl}`);
                  localStorage.setItem('importWebhookUrl', webhookUrl);
                }
              } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤:', e);
              }
            } else if (testImportUrl) {
              webhookUrl = testImportUrl;
              console.log(`–ù–∞–π–¥–µ–Ω URL –∏–º–ø–æ—Ä—Ç–∞ –≤ testImportUrl: ${webhookUrl}`);
            }
          }

          console.log('–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å URL:', webhookUrl);

          if (webhookUrl) {
            if (window.devMode && window.devMode.enabled) {
              console.log(`üîß [DevMode] –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤–µ–±—Ö—É–∫ –∏–º–ø–æ—Ä—Ç–∞: ${webhookUrl}`);
            }

            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 10000);

            try {
              const importResponse = await fetch(webhookUrl, {
                method: 'GET',
                headers: {
                  'Accept': 'application/json, text/plain, */*',
                  'Content-Type': 'application/json'
                },
                cache: 'no-store',
                signal: controller.signal
              });

              clearTimeout(timeoutId);

              if (importResponse.ok) {
                let importData;
                const responseText = await importResponse.text();
                console.log('–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç –≤–µ–±—Ö—É–∫–∞, —Ä–∞–∑–º–µ—Ä:', responseText.length, '–±–∞–π—Ç');

                try {
                  importData = JSON.parse(responseText);
                  if (window.devMode && window.devMode.enabled) {
                    console.log('üîß [DevMode] –£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Å –≤–µ–±—Ö—É–∫–∞ –∏–º–ø–æ—Ä—Ç–∞');
                    console.log('üîß [DevMode] –†–∞–∑–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', responseText.length, '–±–∞–π—Ç');
                  }
                } catch (jsonError) {
                  if (window.devMode && window.devMode.enabled) {
                    console.log(`üîß [DevMode] –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ JSON: ${jsonError.message}`);
                    console.log('üîß [DevMode] –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ JSON –≤ —Ç–µ–∫—Å—Ç–µ –æ—Ç–≤–µ—Ç–∞');
                  }
                  try {
                    const jsonRegex = /{[\s\S]*}/;
                    const match = responseText.match(jsonRegex);
                    if (match && match[0]) {
                      importData = JSON.parse(match[0]);
                      if (window.devMode && window.devMode.enabled) {
                        console.log('üîß [DevMode] –ù–∞–π–¥–µ–Ω –∏ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω JSON –≤ —Ç–µ–∫—Å—Ç–µ –æ—Ç–≤–µ—Ç–∞');
                      }
                    }
                  } catch (extractError) {
                    if (window.devMode && window.devMode.enabled) {
                      console.log(`üîß [DevMode] –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å JSON –∏–∑ —Ç–µ–∫—Å—Ç–∞: ${extractError.message}`);
                    }
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞');
                  }
                }

                let coursesData = null;
                if (importData) {
                  if (window.devMode && window.devMode.enabled) {
                    console.log(`üîß [DevMode] –ê–Ω–∞–ª–∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:`, Object.keys(importData));
                  }
                  if (importData.courses) {
                    coursesData = importData.courses;
                    if (window.devMode && window.devMode.enabled) {
                      console.log(`üîß [DevMode] –ù–∞–π–¥–µ–Ω—ã –∫—É—Ä—Å—ã –≤ –ø–æ–ª–µ 'courses'`);
                    }
                  } else if (importData.data && typeof importData.data === 'object') {
                    coursesData = importData.data;
                    if (window.devMode && window.devMode.enabled) {
                      console.log(`üîß [DevMode] –ù–∞–π–¥–µ–Ω—ã –∫—É—Ä—Å—ã –≤ –ø–æ–ª–µ 'data' (–æ–±—ä–µ–∫—Ç)`);
                    }
                  } else if (importData.content && typeof importData.content === 'object') {
                    coursesData = importData.content;
                    if (window.devMode && window.devMode.enabled) {
                      console.log(`üîß [DevMode] –ù–∞–π–¥–µ–Ω—ã –∫—É—Ä—Å—ã –≤ –ø–æ–ª–µ 'content' (–æ–±—ä–µ–∫—Ç)`);
                    }
                  } else if (importData.data && typeof importData.data === 'string') {
                    try {
                      const parsedData = JSON.parse(importData.data);
                      if (parsedData.courses) {
                        coursesData = parsedData.courses;
                        if (window.devMode && window.devMode.enabled) {
                          console.log(`üîß [DevMode] –ù–∞–π–¥–µ–Ω—ã –∫—É—Ä—Å—ã –≤ –ø–æ–ª–µ 'data' (JSON —Å—Ç—Ä–æ–∫–∞ -> courses)`);
                        }
                      } else {
                        coursesData = parsedData;
                        if (window.devMode && window.devMode.enabled) {
                          console.log(`üîß [DevMode] –ù–∞–π–¥–µ–Ω—ã –∫—É—Ä—Å—ã –≤ –ø–æ–ª–µ 'data' (JSON —Å—Ç—Ä–æ–∫–∞ -> –≤–µ—Å—å –æ–±—ä–µ–∫—Ç)`);
                        }
                      }
                    } catch (e) {
                      if (window.devMode && window.devMode.enabled) {
                        console.log(`üîß [DevMode] –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Å—Ç—Ä–æ–∫–∏ data: ${e.message}`);
                      }
                    }
                  } else if (typeof importData === 'object') {
                    const hasValidStructure = Object.values(importData).some(value => {
                      return value && typeof value === 'object' && 
                            (value.days || value.specialLessons || value.title || value.redirectUrl || value.noDayLessons);
                    });
                    if (hasValidStructure) {
                      coursesData = importData;
                      if (window.devMode && window.devMode.enabled) {
                        console.log(`üîß [DevMode] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∫–∞–∫ courses (–Ω–∞–π–¥–µ–Ω—ã –ø–æ–ª—è days/specialLessons/title)`);
                      }
                    }
                  }
                }

                if (coursesData) {
                  const courseKeys = Object.keys(coursesData);
                  const validStructure = courseKeys.length > 0 && 
                    courseKeys.some(key => {
                      const course = coursesData[key];
                      return course && typeof course === 'object' && 
                            (course.days || course.specialLessons || course.redirectUrl);
                    });
                  if (!validStructure) {
                    if (window.devMode && window.devMode.enabled) {
                      console.log(`üîß [DevMode] –ü–æ–ª—É—á–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—É –∫—É—Ä—Å–æ–≤`, coursesData);
                    }
                    throw new Error('–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫—É—Ä—Å–æ–≤');
                  }
                  this.courses = coursesData;
                  console.log('–ö—É—Ä—Å—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å –≤–µ–±—Ö—É–∫–∞ –∏–º–ø–æ—Ä—Ç–∞');
                  console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏:', Object.keys(this.courses));
                  Object.keys(this.courses).forEach(profId => {
                    const course = this.courses[profId];
                    console.log(`–ü—Ä–æ—Ñ–µ—Å—Å–∏—è ${profId}: ${course.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}`);
                    if (course.days) {
                      console.log(`- –î–Ω–µ–π –æ–±—É—á–µ–Ω–∏—è: ${course.days.length}`);
                      course.days.forEach(day => {
                        console.log(`  - –î–µ–Ω—å ${day.id}: ${day.title} (${day.lessons ? day.lessons.length : 0} —É—Ä–æ–∫–æ–≤)`);
                      });
                    }
                    if (course.specialLessons) {
                      console.log(`- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Ä–æ–∫–æ–≤: ${course.specialLessons.length}`);
                    }
                  });
                  localStorage.setItem('coursesBackup', JSON.stringify(this.courses));
                  localStorage.setItem('coursesBackupTimestamp', new Date().toISOString());
                  console.log('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage, –º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:', new Date().toISOString());
                  if (window.devMode && window.devMode.enabled) {
                    console.log('üîß [DevMode] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫—É—Ä—Å–æ–≤ –≤ localStorage');
                    console.log('üîß [DevMode] –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤:', Object.keys(this.courses));
                  }
                  this.notifyCoursesUpdated();
                  return true;
                } else {
                  throw new Error('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫—É—Ä—Å–∞—Ö');
                }
              } else {
                throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –≤–µ–±—Ö—É–∫—É –∏–º–ø–æ—Ä—Ç–∞: ${importResponse.status}`);
              }
            } catch (fetchError) {
              clearTimeout(timeoutId);
              if (fetchError.name === 'AbortError') {
                throw new Error('–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ –≤–µ–±—Ö—É–∫—É –∏–º–ø–æ—Ä—Ç–∞');
              } else {
                throw fetchError;
              }
            }
          } else {
            throw new Error('URL –≤–µ–±—Ö—É–∫–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
          }
        } catch (importError) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö —Å –≤–µ–±—Ö—É–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', importError);
          if (window.devMode && window.devMode.enabled) {
            console.log(`üîß [DevMode] –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å –≤–µ–±—Ö—É–∫–∞: ${importError.message}`);
            console.log('üîß [DevMode] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ localStorage');
          }
          const backupStr = localStorage.getItem('coursesBackup');
          if (backupStr) {
            try {
              this.courses = JSON.parse(backupStr);
              const timestamp = localStorage.getItem('coursesBackupTimestamp') || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
              console.log(`–ö—É—Ä—Å—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ (${timestamp})`);
              if (window.devMode && window.devMode.enabled) {
                console.log(`üîß [DevMode] –ó–∞–≥—Ä—É–∂–µ–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫—É—Ä—Å–æ–≤ –∏–∑ localStorage –æ—Ç ${timestamp}`);
              }
              return true;
            } catch (backupError) {
              console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', backupError);
              if (window.devMode && window.devMode.enabled) {
                console.log(`üîß [DevMode] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞`);
              }
            }
          } else {
            if (window.devMode && window.devMode.enabled) {
              console.log('üîß [DevMode] –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª');
            }
          }
          try {
            if (window.devMode && window.devMode.enabled) {
              console.log('üîß [DevMode] –ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ courses.json');
            }
            const coursesResponse = await fetch('data/courses.json');
            if (coursesResponse.ok) {
              this.courses = await coursesResponse.json();
              console.log('–ö—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ courses.json (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)');
              localStorage.setItem('coursesBackup', JSON.stringify(this.courses));
              localStorage.setItem('coursesBackupTimestamp', new Date().toISOString());
              if (window.devMode && window.devMode.enabled) {
                console.log('üîß [DevMode] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫—É—Ä—Å–æ–≤ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞');
              }
            } else {
              throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—É—Ä—Å–æ–≤ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞: ${coursesResponse.status}`);
            }
          } catch (coursesError) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ courses.json:', coursesError);
            this.courses = {};
            return false;
          }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        try {
          const fallbacksResponse = await fetch('data/fallbacks.json');
          if (fallbacksResponse.ok) {
            this.fallbacks = await fallbacksResponse.json();
            localStorage.setItem('fallbacksBackup', JSON.stringify(this.fallbacks));
            localStorage.setItem('fallbacksBackupTimestamp', new Date().toISOString());
          } else {
            throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç: ${fallbacksResponse.status}`);
          }
        } catch (fallbacksError) {
          console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ fallbacks.json:', fallbacksError);
          const backupStr = localStorage.getItem('fallbacksBackup');
          if (backupStr) {
            try {
              this.fallbacks = JSON.parse(backupStr);
              const timestamp = localStorage.getItem('fallbacksBackupTimestamp') || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
              console.log(`–†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –∫–æ–ø–∏–∏ (${timestamp})`);
            } catch (backupError) {
              console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', backupError);
              this.fallbacks = {};
            }
          } else {
            console.warn('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è fallbacks –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç');
            this.fallbacks = {};
          }
        }

        console.log('CourseManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
        return true;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ CourseManager:', error);
        return false;
      }
    }

    getProfessions(includeHidden = false) {
      if (!this.courses || typeof this.courses !== 'object') {
        console.error('–û–±—ä–µ–∫—Ç courses –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º:', this.courses);
        return [];
      }
      if (includeHidden) {
        return Object.keys(this.courses);
      } else {
        const visibleCourses = Object.keys(this.courses).filter(profId => {
          const course = this.courses[profId];
          const isHidden = course.hidden === true;
          console.log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫—É—Ä—Å–∞ ${profId}: hidden=${course.hidden}, isHidden=${isHidden}`);
          return !isHidden;
        });
        console.log('–í–∏–¥–∏–º—ã–µ –∫—É—Ä—Å—ã:', visibleCourses);
        return visibleCourses;
      }
    }

    switchProfession(professionId) {
      if (this.courses[professionId]) {
        this.currentProfession = professionId;
        this.currentDay = null;
        this.currentLesson = null;
        return true;
      }
      return false;
    }

    hasRedirect(professionId = this.currentProfession) {
      return this.courses[professionId]?.redirectUrl !== undefined;
    }

    getRedirectUrl(professionId = this.currentProfession) {
      return this.courses[professionId]?.redirectUrl;
    }

    getDays() {
      if (!this.courses[this.currentProfession] || !this.courses[this.currentProfession].days) {
        return [];
      }
      return this.courses[this.currentProfession].days;
    }

    getSpecialLessons() {
      if (!this.courses[this.currentProfession] || !this.courses[this.currentProfession].specialLessons) {
        return [];
      }
      return this.courses[this.currentProfession].specialLessons;
    }

    selectDay(dayId) {
      const day = this.getDays().find(d => d.id === dayId);
      if (day) {
        this.currentDay = day;
        this.currentLesson = null;
        return day;
      }
      return null;
    }

    getLessonsForCurrentDay() {
      if (!this.currentDay) return [];
      return this.currentDay.lessons || [];
    }

    selectLesson(lessonId) {
      if (!this.courses || Object.keys(this.courses).length === 0) {
        console.error('–û—à–∏–±–∫–∞: –∫—É—Ä—Å—ã –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —É—Ä–æ–∫');
        return null;
      }
      if (this.currentDay && this.currentDay.lessons) {
        const lesson = this.currentDay.lessons.find(l => l.id === lessonId);
        if (lesson) {
          this.currentLesson = lesson;
          console.log(`–í—ã–±—Ä–∞–Ω —É—Ä–æ–∫ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è: ${lesson.title} (ID: ${lesson.id})`);
          return lesson;
        }
      }
      const specialLessons = this.getSpecialLessons();
      if (specialLessons && specialLessons.length > 0) {
        const specialLesson = specialLessons.find(l => l.id === lessonId);
        if (specialLesson) {
          this.currentLesson = specialLesson;
          console.log(`–í—ã–±—Ä–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —É—Ä–æ–∫: ${specialLesson.title} (ID: ${specialLesson.id})`);
          return specialLesson;
        }
      }
      console.error(`–£—Ä–æ–∫ —Å ID ${lessonId} –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ —Ç–µ–∫—É—â–µ–º –¥–Ω–µ, –Ω–∏ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Ä–æ–∫–∞—Ö`);
      return null;
    }

    async fetchLessonContent() {
      if (!this.currentLesson) {
        console.error('–û—à–∏–±–∫–∞: —Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω');
        return null;
      }
      console.log(`–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —É—Ä–æ–∫–∞: ${this.currentLesson.id} (${this.currentLesson.title})`);
      const source = this.currentLesson.contentSource;
      if (!source) {
        console.error('–û—à–∏–±–∫–∞: —É —É—Ä–æ–∫–∞ –Ω–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞');
        return `# ${this.currentLesson.title}\n\n–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–∫–∞ –Ω–µ —É–∫–∞–∑–∞–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.`;
      }
      console.log(`–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:`, source);
      this.showLoadingIndicator();
      const globalStatusElement = document.getElementById('global-loading-status');
      if (globalStatusElement) {
        globalStatusElement.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞ "${this.currentLesson.title}"...`;
      }
      const globalLoadingOverlay = document.getElementById('global-loading-overlay');
      if (globalLoadingOverlay) {
        globalLoadingOverlay.style.display = 'flex';
        globalLoadingOverlay.style.opacity = '1';
      }
      try {
        let content = '';
        if (source.type === 'webhook' && source.url) {
          try {
            if (window.devMode && window.devMode.enabled) {
              console.log(`üîß [DevMode] –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞ '${this.currentLesson.title}' —Å URL: ${source.url}`);
            }
            console.log(`Fetching from: ${source.url}`);
            console.log(`Using simplified GET request`);
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000);
            const response = await fetch(source.url, {
              method: 'GET',
              headers: {
                'Accept': 'text/plain, text/markdown, text/html, application/json, */*',
                'Cache-Control': 'no-cache, no-store, must-revalidate',
                'Pragma': 'no-cache'
              },
              mode: 'cors',
              cache: 'no-store',
              signal: controller.signal
            });
            clearTimeout(timeoutId);
            console.log(`Response status: ${response.status}`);
            if (!response.ok) {
              throw new Error(`HTTP –æ—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }
            content = await response.text();
            console.log(`Response size: ${content.length} bytes`);
            console.log(`Response preview: "${content.substring(0, 100)}${content.length > 100 ? '...' : ''}"`);
            console.log(`Response received successfully!`);
            if (content.trim().startsWith('{') || content.trim().startsWith('[')) {
              try {
                const jsonData = JSON.parse(content);
                console.log('–ü–æ–ª—É—á–µ–Ω JSON –æ—Ç–≤–µ—Ç, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:', Object.keys(jsonData));
                if (jsonData.content) {
                  console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ content –∏–∑ JSON');
                  content = jsonData.content;
                }
                else if (jsonData.markdown) {
                  console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ markdown –∏–∑ JSON');
                  content = jsonData.markdown;
                }
                else if (jsonData.text) {
                  console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ text –∏–∑ JSON');
                  content = jsonData.text;
                }
                else if (jsonData.html) {
                  console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ html –∏–∑ JSON');
                  content = jsonData.html;
                }
                else if (jsonData.data && typeof jsonData.data === 'string') {
                  console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ data (—Å—Ç—Ä–æ–∫–∞) –∏–∑ JSON');
                  content = jsonData.data;
                }
              } catch (e) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–≤–µ—Ç –∫–∞–∫ —Ç–µ–∫—Å—Ç:', e.message);
              }
            }
            if (window.devMode && window.devMode.enabled) {
              console.log(`üîß [DevMode] –ö–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω (${content.length} —Å–∏–º–≤–æ–ª–æ–≤)`);
            }
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –≤–µ–±—Ö—É–∫–∞:', error);
            if (source.fallbackType === 'local' && source.fallbackId) {
              console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:', source.fallbackId);
              if (window.devMode && window.devMode.enabled) {
                console.log(`üîß [DevMode] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å ID: ${source.fallbackId}`);
              }
              content = await this.fetchLocalContent(source.fallbackId);
            } else if (source.fallbackType === 'markdown' && source.fallbackContent) {
              console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ä–µ–∑–µ—Ä–≤–Ω—ã–π markdown-–∫–æ–Ω—Ç–µ–Ω—Ç');
              content = source.fallbackContent;
            } else {
              content = `# ${this.currentLesson.title}\n\n## –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞\n\n–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞.\n\n–û—à–∏–±–∫–∞: ${error.message}\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –∫–æ–º–∞–Ω–¥—ã.`;
            }
          }
        } else if (source.type === 'local' && source.id) {
          if (window.devMode && window.devMode.enabled) {
            console.log(`üîß [DevMode] –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å ID: ${source.id}`);
          }
          content = await this.fetchLocalContent(source.id);
        } else if (source.type === 'markdown' && source.content) {
          if (window.devMode && window.devMode.enabled) {
            console.log(`üîß [DevMode] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ Markdown –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (${source.content.length} —Å–∏–º–≤–æ–ª–æ–≤)`);
          }
          content = source.content;
        }
        this.hideLoadingIndicator();
        return content;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞:', error);
        if (window.devMode && window.devMode.enabled) {
          console.log(`üîß [DevMode] –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞: ${error.message}`);
        }
        this.hideLoadingIndicator();
        throw error;
      }
    }

    async fetchTest(lesson = this.currentLesson) {
      if (!lesson || !lesson.testSource) {
        return null;
      }
      try {
        const testSource = lesson.testSource;
        if (testSource.type === 'webhook') {
          try {
            const response = await fetch(testSource.url, {
              method: 'GET',
              headers: {
                'Accept': 'text/plain, text/markdown, application/json, */*'
              },
              mode: 'cors',
              cache: 'no-cache'
            });
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            let content = await response.text();
            if (content.trim().startsWith('{') || content.trim().startsWith('[')) {
              try {
                const json = JSON.parse(content);
                if (json.test) content = json.test;
                else if (json.content) content = json.content;
                else if (json.markdown) content = json.markdown;
              } catch (e) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–≤–µ—Ç –∫–∞–∫ —Ç–µ–∫—Å—Ç');
              }
            }
            return content;
          } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–µ—Å—Ç–∞ —Å –≤–µ–±—Ö—É–∫–∞: ${error.message}`);
            if (testSource.fallbackType === 'markdown' && testSource.fallbackId) {
              try {
                const response = await fetch(`data/tests/${testSource.fallbackId}.md`);
                if (response.ok) {
                  return await response.text();
                }
              } catch (e) {
                console.error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç: ${e.message}`);
              }
            }
          }
        } else if (testSource.type === 'markdown' && testSource.id) {
          try {
            const response = await fetch(`data/tests/${testSource.id}.md`);
            if (response.ok) {
              return await response.text();
            }
          } catch (e) {
            console.error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç: ${e.message}`);
          }
        }
        return null;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–µ—Å—Ç–∞:', error);
        return null;
      }
    }

    getTask(lesson = this.currentLesson) {
      if (!lesson || !lesson.taskSource) {
        return null;
      }
      const taskSource = lesson.taskSource;
      if (taskSource.type === 'markdown' && taskSource.content) {
        return taskSource.content;
      }
      return null;
    }

    getAudioInfo(lesson = this.currentLesson) {
      if (!lesson || !lesson.audioSource) {
        return null;
      }
      return lesson.audioSource;
    }

    showLoadingIndicator() {
      //Implementation for showing loading indicator
    }

    hideLoadingIndicator() {
      //Implementation for hiding loading indicator
    }

    async fetchLocalContent(id) {
      try {
        const response = await fetch(`data/content/${id}.md`);
        if (response.ok) {
          return await response.text();
        } else {
          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å ID ${id}: ${response.status}`);
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:", error);
        return null;
      }
    }

    saveBackup() {
      if (this.courses) {
        localStorage.setItem('coursesBackup', JSON.stringify(this.courses));
        localStorage.setItem('coursesBackupTimestamp', new Date().toISOString());
        if (window.devMode && window.devMode.enabled) {
          console.log('üîß [DevMode] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫—É—Ä—Å–æ–≤');
        }
      }
      if (this.fallbacks) {
        localStorage.setItem('fallbacksBackup', JSON.stringify(this.fallbacks));
        localStorage.setItem('fallbacksBackupTimestamp', new Date().toISOString());
      }
    }

    restoreFromBackup() {
      const coursesBackup = localStorage.getItem('coursesBackup');
      const fallbacksBackup = localStorage.getItem('fallbacksBackup');
      let restored = false;
      if (coursesBackup) {
        try {
          this.courses = JSON.parse(coursesBackup);
          const timestamp = localStorage.getItem('coursesBackupTimestamp') || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
          console.log(`–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫—É—Ä—Å—ã –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ (${timestamp})`);
          restored = true;
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫—É—Ä—Å–æ–≤ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', e);
        }
      }
      if (fallbacksBackup) {
        try {
          this.fallbacks = JSON.parse(fallbacksBackup);
          console.log('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑ –∫–æ–ø–∏–∏');
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', e);
        }
      }
      return restored;
    }

    onCoursesUpdated(callback) {
      if (typeof callback === 'function') {
        this.courseUpdateCallbacks.push(callback);
      }
    }

    notifyCoursesUpdated() {
      if (this.courseUpdateCallbacks && Array.isArray(this.courseUpdateCallbacks)) {
        this.courseUpdateCallbacks.forEach(callback => {
          try {
            callback(this.courses);
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤:', error);
          }
        });
      }
    }
  }

  // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞
  const courseManager = new CourseManager();
  window.courseManager = courseManager;
  // ==================== END COURSE MANAGER CODE ====================


  // ==================== BEGIN DEV MODE CODE ====================
  /**
   * –ú–æ–¥—É–ª—å —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
   * –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–ø—Ä–æ—Å–∞—Ö –∏ –æ—Ç–≤–µ—Ç–∞—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
   */
  class DevMode {
    constructor() {
      this.enabled = true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω
      this.logs = [];
      this.maxLogs = 100; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
      this.requestCounter = 0;
      this._initialized = false;
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
     */
    initialize() {
      if (this._initialized) return;

      console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞...');
      this.createDevPanel();
      this.overrideFetch();
      this.overrideXHR();
      this.addDevModeToggle();
      this._initialized = true;
      console.log('üîß –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
    }

    /**
     * –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
     */
    createDevPanel() {
      const devPanel = document.createElement('div');
      devPanel.id = 'dev-mode-panel';
      devPanel.className = 'dev-panel';
      devPanel.innerHTML = `
        <div class="dev-panel-header">
          <h3>–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</h3>
          <div class="dev-panel-actions">
            <button id="dev-panel-standalone" title="–û—Ç–∫—Ä—ã—Ç—å Standalone –≤–µ—Ä—Å–∏—é"><i class="fas fa-external-link-alt"></i></button>
            <button id="dev-panel-analyze" title="–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ–≤"><i class="fas fa-chart-bar"></i></button>
            <button id="dev-panel-debug" title="–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"><i class="fas fa-bug"></i></button>
            <button id="dev-panel-storage" title="LocalStorage –º–µ–Ω–µ–¥–∂–µ—Ä"><i class="fas fa-database"></i></button>
            <button id="dev-panel-sync" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –æ–±–ª–∞–∫–æ–º"><i class="fas fa-sync-alt"></i></button>
            <button id="dev-panel-clear" title="–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏"><i class="fas fa-trash"></i></button>
            <button id="dev-panel-minimize" title="–°–≤–µ—Ä–Ω—É—Ç—å –ø–∞–Ω–µ–ª—å"><i class="fas fa-minus"></i></button>
          </div>
        </div>
        <div class="dev-panel-body">
          <div id="dev-panel-logs"></div>
        </div>
      `;

      document.body.appendChild(devPanel);
      this.addDevPanelStyles();
      document.getElementById('dev-panel-clear').addEventListener('click', () => {
        this.clearLogs();
      });
      document.getElementById('dev-panel-minimize').addEventListener('click', () => {
        devPanel.classList.toggle('minimized');
        if (devPanel.classList.contains('minimized')) {
          document.getElementById('dev-panel-minimize').innerHTML = '<i class="fas fa-plus"></i>';
        } else {
          document.getElementById('dev-panel-minimize').innerHTML = '<i class="fas fa-minus"></i>';
        }
      });
      document.getElementById('dev-panel-analyze').addEventListener('click', () => {
        this.analyzeAndDisplayCourses();
      });
      document.getElementById('dev-panel-sync').addEventListener('click', () => {
        this.syncWithCloud();
      });
      document.getElementById('dev-panel-debug').addEventListener('click', () => {
        this.showDebugInfo();
      });
      document.getElementById('dev-panel-storage').addEventListener('click', () => {
        this.showLocalStorageManager();
      });
      document.getElementById('dev-panel-standalone').addEventListener('click', () => {
        window.open('standalone.html', '_blank');
      });
    }

    /**
     * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –¥–ª—è –ø–∞–Ω–µ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
     */
    addDevPanelStyles() {
      const styleElement = document.createElement('style');
      styleElement.textContent = `
        .dev-panel {
          position: fixed;
          bottom: 0;
          right: 0;
          width: 500px;
          max-width: 100%;
          height: 300px;
          background-color: rgba(40, 44, 52, 0.95);
          color: #eee;
          border-top-left-radius: 8px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
          font-family: 'Consolas', 'Monaco', monospace;
          font-size: 12px;
          z-index: 10000;
          display: flex;
          flex-direction: column;
          transition: all 0.3s ease;
        }

        .dev-panel.minimized {
          height: 36px;
          overflow: hidden;
        }

        .dev-panel-header {
          background-color: #1e2127;
          padding: 8px 10px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          border-top-left-radius: 8px;
          user-select: none;
        }

        .dev-panel-header h3 {
          margin: 0;
          font-size: 14px;
          font-weight: normal;
        }

        .dev-panel-actions {
          display: flex;
          gap: 5px;
        }

        .dev-panel-actions button {
          background: none;
          border: none;
          color: #aaa;
          cursor: pointer;
          font-size: 12px;
          width: 20px;
          height: 20px;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 3px;
        }

        .dev-panel-actions button:hover {
          background-color: rgba(255, 255, 255, 0.1);
          color: #fff;
        }

        .dev-panel-body {
          flex: 1;
          overflow-y: auto;
          padding: 10px;
        }

        #dev-panel-logs {
          font-family: 'Consolas', 'Monaco', monospace;
          font-size: 12px;
          line-height: 1.4;
        }

        .dev-log-entry {
          margin-bottom: 10px;
          padding-bottom: 10px;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dev-log-entry-header {
          display: flex;
          justify-content: space-between;
          margin-bottom: 3px;
        }

        .dev-log-timestamp {
          color: #aaa;
          font-size: 10px;
        }

        .dev-log-url {
          color: #61afef;
          word-break: break-all;
        }

        .dev-log-method {
          color: #98c379;
          font-weight: bold;
          margin-right: 5px;
        }

        .dev-log-status {
          font-weight: bold;
        }

        .dev-log-status.success {
          color: #98c379;
        }

        .dev-log-status.error {
          color: #e06c75;
        }

        .dev-log-button {
          padding: 2px 5px;
          background-color: rgba(255, 255, 255, 0.1);
          border: none;
          border-radius: 3px;
          color: #ddd;
          cursor: pointer;
          font-size: 11px;
          margin-top: 5px;
        }

        .dev-log-button:hover {
          background-color: rgba(255, 255, 255, 0.2);
        }

        .dev-log-details {
          background-color: rgba(0, 0, 0, 0.2);
          padding: 5px;
          margin-top: 5px;
          border-radius: 3px;
          display: none;
        }

        .dev-log-details.visible {
          display: block;
        }

        .dev-log-label {
          color: #d19a66;
          margin-right: 5px;
        }

        .dev-log-message {
          word-break: break-word;
        }

        .dev-log-message.success {
          color: #98c379;
        }

        .dev-log-message.error {
          color: #e06c75;
        }

        .dev-log-message.warning {
          color: #e5c07b;
        }

        .dev-log-message.info {
          color: #61afef;
        }

        .dev-info-badge {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background-color: rgba(97, 175, 239, 0.8);
          color: white;
          font-size: 12px;
          cursor: pointer;
          margin-left: 5px;
          vertical-align: middle;
        }

        .dev-info-tooltip {
          position: absolute;
          background-color: #282c34;
          color: #eee;
          padding: 10px;
          border-radius: 5px;
          box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
          z-index: 10001;
          max-width: 400px;
          font-size: 12px;
          display: none;
        }

        .dev-info-tooltip.visible {
          display: block;
        }

        .dev-info-badge:hover + .dev-info-tooltip {
          display: block;
        }

        .dev-mode-toggle {
          position: fixed;
          top: 10px;
          right: 10px;
          background-color: rgba(40, 44, 52, 0.8);
          color: white;
          border: none;
          border-radius: 4px;
          padding: 5px 10px;
          cursor: pointer;
          font-size: 12px;
          z-index: 9999;
          display: flex;
          align-items: center;
          gap: 5px;
        }

        .dev-mode-toggle i {
          font-size: 14px;
        }

        .dev-mode-toggle.enabled {
          background-color: rgba(152, 195, 121, 0.8);
        }

        .dev-mode-toggle-hidden {
          display: none !important;
        }

        .admin-form-group {
          position: relative;
        }

        .admin-webhook-info {
          position: relative;
          display: inline-block;
        }

        @media (max-width: 768px) {
          .dev-panel {
            width: 100%;
            height: 200px;
          }
        }
      `;
      document.head.appendChild(styleElement);
    }

    addDevModeToggle() {
      const toggle = document.createElement('button');
      toggle.id = 'dev-mode-toggle';
      toggle.className = 'dev-mode-toggle' + (this.enabled ? ' enabled' : '');
      toggle.innerHTML = `
        <i class="fas fa-code"></i>
        <span>–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</span>
      `;
      toggle.addEventListener('click', () => {
        this.toggleDevMode();
      });
      document.body.appendChild(toggle);
    }

    toggleDevMode() {
      this.enabled = !this.enabled;
      const toggle = document.getElementById('dev-mode-toggle');
      const devPanel = document.getElementById('dev-mode-panel');
      if (this.enabled) {
        toggle.classList.add('enabled');
        devPanel.style.display = 'flex';
        this.addInfoBadgesToAdminForms();
      } else {
        toggle.classList.remove('enabled');
        devPanel.style.display = 'none';
        this.removeInfoBadgesFromAdminForms();
      }
      console.log(`üîß –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ ${this.enabled ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`);
    }

    overrideFetch() {
      const originalFetch = window.fetch;
      const self = this;
      window.fetch = function(resource, init) {
        const startTime = performance.now();
        const requestId = ++self.requestCounter;
        let method = 'GET';
        let requestBody = null;
        if (init) {
          method = init.method || 'GET';
          requestBody = init.body || null;
        }
        const requestInfo = {
          id: requestId,
          url: resource instanceof Request ? resource.url : resource,
          method: method,
          headers: init?.headers ? (init.headers instanceof Headers ? Object.fromEntries(init.headers.entries()) : init.headers) : {},
          body: requestBody,
          timestamp: new Date(),
          startTime: startTime
        };
        if (self.enabled) {
          self.logRequest(requestInfo);
        }
        return originalFetch.apply(this, arguments)
          .then(response => {
            const endTime = performance.now();
            const duration = endTime - startTime;
            const clonedResponse = response.clone();
            clonedResponse.text().then(responseText => {
              const responseInfo = {
                status: response.status,
                statusText: response.statusText,
                headers: Object.fromEntries(response.headers.entries()),
                body: responseText,
                duration: duration.toFixed(2)
              };
              if (self.enabled) {
                self.logResponse(requestId, responseInfo);
              }
            }).catch(err => {
              console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞:', err);
            });
            return response;
          })
          .catch(error => {
            const endTime = performance.now();
            const duration = endTime - startTime;
            if (self.enabled) {
              self.logError(requestId, error, duration.toFixed(2));
            }
            throw error;
          });
      };
    }

    overrideXHR() {
      const self = this;
      const originalOpen = XMLHttpRequest.prototype.open;
      const originalSend = XMLHttpRequest.prototype.send;
      XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
        this._devModeInfo = {
          id: ++self.requestCounter,
          method: method,
          url: url,
          timestamp: new Date(),
          startTime: performance.now()
        };
        return originalOpen.apply(this, arguments);
      };
      XMLHttpRequest.prototype.send = function(body) {
        if (this._devModeInfo) {
          this._devModeInfo.body = body;
          if (self.enabled) {
            self.logRequest(this._devModeInfo);
          }
          this.addEventListener('load', function() {
            const endTime = performance.now();
            const duration = endTime - this._devModeInfo.startTime;
            const responseInfo = {
              status: this.status,
              statusText: this.statusText,
              headers: this.getAllResponseHeaders().split('\r\n').reduce((result, header) => {
                const parts = header.split(': ');
                if (parts[0] && parts[1]) {
                  result[parts[0]] = parts[1];
                }
                return result;
              }, {}),
              body: this.responseText,
              duration: duration.toFixed(2)
            };
            if (self.enabled) {
              self.logResponse(this._devModeInfo.id, responseInfo);
            }
          });
          this.addEventListener('error', function(error) {
            const endTime = performance.now();
            const duration = endTime - this._devModeInfo.startTime;
            if (self.enabled) {
              self.logError(this._devModeInfo.id, new Error('Network Error'), duration.toFixed(2));
            }
          });
          this.addEventListener('timeout', function() {
            const endTime = performance.now();
            const duration = endTime - this._devModeInfo.startTime;
            if (self.enabled) {
              self.logError(this._devModeInfo.id, new Error('Request Timeout'), duration.toFixed(2));
            }
          });
        }
        return originalSend.apply(this, arguments);
      };
    }

    logRequest(requestInfo) {
      const requestLog = {
        id: requestInfo.id,
        type: 'request',
        method: requestInfo.method,
        url: requestInfo.url,
        headers: requestInfo.headers,
        body: requestInfo.body,
        timestamp: requestInfo.timestamp,
        startTime: requestInfo.startTime
      };
      this.logs.push(requestLog);
      this.trimLogs();
      this.renderLogEntry(requestLog);
    }

    logResponse(requestId, responseInfo) {
      const requestLog = this.logs.find(log => log.id === requestId && log.type === 'request');
      if (requestLog) {
        const responseLog = {
          id: requestId,
          type: 'response',
          status: responseInfo.status,
          statusText: responseInfo.statusText,
          headers: responseInfo.headers,
          body: responseInfo.body,
          duration: responseInfo.duration,
          timestamp: new Date()
        };
        this.logs.push(responseLog);
        this.trimLogs();
        this.updateLogEntry(requestId, responseLog);
      }
    }

    logError(requestId, error, duration) {
      const requestLog = this.logs.find(log => log.id === requestId && log.type === 'request');
      if (requestLog) {
        const errorLog = {
          id: requestId,
          type: 'error',
          error: error.message || 'Unknown error',
          stack: error.stack,
          duration: duration,
          timestamp: new Date()
        };
        this.logs.push(errorLog);
        this.trimLogs();
        this.updateLogEntry(requestId, errorLog);
      }
    }

    trimLogs() {
      if (this.logs.length > this.maxLogs) {
        const logsToRemove = this.logs.length - this.maxLogs;
        this.logs.splice(0, logsToRemove);
      }
    }

    renderLogEntry(log) {
      const logsContainer = document.getElementById('dev-panel-logs');
      if (!logsContainer) return;
      const logEntry = document.createElement('div');
      logEntry.id = `dev-log-${log.id}`;
      logEntry.className = 'dev-log-entry';
      const timestamp = new Date(log.timestamp).toLocaleTimeString();
      if (log.type === 'request') {
        logEntry.innerHTML = `
          <div class="dev-log-entry-header">
            <span>
              <span class="dev-log-method">${log.method}</span>
              <span class="dev-log-url">${this.truncateString(log.url, 60)}</span>
            </span>
            <span class="dev-log-timestamp">${timestamp}</span>
          </div>
          <div>
            <button class="dev-log-button" onclick="window.devMode.toggleLogDetails(${log.id})">–î–µ—Ç–∞–ª–∏</button>
          </div>
          <div id="dev-log-details-${log.id}" class="dev-log-details">
            <div><span class="dev-log-label">URL:</span> ${log.url}</div>
            <div><span class="dev-log-label">–ú–µ—Ç–æ–¥:</span> ${log.method}</div>
            <div><span class="dev-log-label">–ó–∞–≥–æ–ª–æ–≤–∫–∏:</span> ${this.formatJson(log.headers)}</div>
            ${log.body ? `<div><span class="dev-log-label">–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:</span> ${this.formatRequestBody(log.body)}</div>` : ''}
          </div>
        `;
      }
      logsContainer.prepend(logEntry);
    }

    updateLogEntry(requestId, log) {
      const logEntry = document.getElementById(`dev-log-${requestId}`);
      if (!logEntry) return;
      const logDetails = document.getElementById(`dev-log-details-${requestId}`);
      if (log.type === 'response') {
        const statusClass = log.status >= 200 && log.status < 400 ? 'success' : 'error';
        const logHeader = logEntry.querySelector('.dev-log-entry-header');
        if (logHeader) {
          logHeader.insertAdjacentHTML('beforeend', `
            <span class="dev-log-status ${statusClass}">${log.status}</span>
          `);
        }
        const logActions = logEntry.querySelector('.dev-log-button').parentNode;
        if (logActions) {
          logActions.insertAdjacentHTML('beforeend', `
            <span style="margin-left: 10px; color: #aaa;">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${log.duration} –º—Å</span>
          `);
        }
        if (logDetails) {
          logDetails.insertAdjacentHTML('beforeend', `
            <div style="margin-top: 10px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 5px;">
              <div><span class="dev-log-label">–°—Ç–∞—Ç—É—Å:</span> ${log.status} ${log.statusText}</div>
              <div><span class="dev-log-label">–ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:</span> ${this.formatJson(log.headers)}</div>
              <div><span class="dev-log-label">–¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞:</span> ${this.formatResponseBody(log.body)}</div>
            </div>
          `);
        }
      } else if (log.type === 'error') {
        const logHeader = logEntry.querySelector('.dev-log-entry-header');
        if (logHeader) {
          logHeader.insertAdjacentHTML('beforeend', `
            <span class="dev-log-status error">ERROR</span>
          `);
        }
        const logActions = logEntry.querySelector('.dev-log-button').parentNode;
        if (logActions) {
          logActions.insertAdjacentHTML('beforeend', `
            <span style="margin-left: 10px; color: #aaa;">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${log.duration} –º—Å</span>
          `);
        }
        if (logDetails) {
          logDetails.insertAdjacentHTML('beforeend', `
            <div style="margin-top: 10px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 5px;">
              <div><span class="dev-log-label">–û—à–∏–±–∫–∞:</span> <span style="color: #e06c75;">${log.error}</span></div>
              ${log.stack ? `<div><span class="dev-log-label">–°—Ç–µ–∫:</span> <pre style="margin: 5px 0; white-space: pre-wrap;">${log.stack}</pre></div>` : ''}
            </div>
          `);
        }
      }
    }

    toggleLogDetails(logId) {
      const logDetails = document.getElementById(`dev-log-details-${logId}`);
      if (logDetails) {
        logDetails.classList.toggle('visible');
      }
    }

    formatJson(obj) {
      try {
        if (!obj) return 'null';
        const jsonString = JSON.stringify(obj, null, 2);
        return `<pre style="margin: 5px 0;">${this.highlightJson(jsonString)}</pre>`;
      } catch (error) {
        return String(obj);
      }
    }

    highlightJson(jsonString) {
      return jsonString
        .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, (match) => {
          let cls = 'number';
          if (/^"/.test(match)) {
            if (/:$/.test(match)) {
              cls = 'key';
              match = match.replace(/"/, '<span style="color: #d19a66;">').replace(/":\s*$/, '</span>:');
              return match;
            } else {
              cls = 'string';
              return `<span style="color: #98c379;">${match}</span>`;
            }
          } else if (/true|false/.test(match)) {
            cls = 'boolean';
            return `<span style="color: #56b6c2;">${match}</span>`;
          } else if (/null/.test(match)) {
            cls = 'null';
            return `<span style="color: #56b6c2;">${match}</span>`;
          } else {
            return `<span style="color: #d19a66;">${match}</span>`;
          }
        });
    }

    formatRequestBody(body) {
      if (!body) return 'null';
      if (typeof body === 'string') {
        try {
          const json = JSON.parse(body);
          return this.formatJson(json);
        } catch (e) {
          return `<pre style="margin: 5px 0; white-space: pre-wrap;">${body}</pre>`;
        }
      } else if (body instanceof FormData) {
        const entries = Array.from(body.entries());
        if (entries.length === 0) return 'FormData (–ø—É—Å—Ç–æ)';
        const formDataObj = {};
        entries.forEach(([key, value]) => {
          formDataObj[key] = value instanceof File ? `File: ${value.name} (${value.type}, ${value.size} bytes)` : value;
        });
        return this.formatJson(formDataObj);
      } else if (body instanceof Blob) {
        return `Blob (${body.type}, ${body.size} bytes)`;
      } else {
        return this.formatJson(body);
      }
    }

    formatResponseBody(body) {
      if (!body) return 'null';
      try {
        const json = JSON.parse(body);
        return this.formatJson(json);
      } catch (e) {
        if (body.length > 5000) {
          return `<pre style="margin: 5px 0; white-space: pre-wrap;">${body.substring(0, 5000)}...</pre>
                  <button class="dev-log-button" onclick="navigator.clipboard.writeText(\`${body.replace(/`/g, '\\`')}\`).then(() => alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!'))">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</button>`;
        }
        return `<pre style="margin: 5px 0; white-space: pre-wrap;">${body}</pre>`;
      }
    }

    addInfoBadgesToAdminForms() {
      const webhookFields = [
        { 
          id: 'admin-export-webhook-url', 
          description: 'URL –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫—É—Ä—Å–∞ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —ç—Ç–æ—Ç URL –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.'
        },
        { 
          id: 'admin-import-webhook-url', 
          description: 'URL –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø—Ä–æ—à–µ–Ω—ã —Å —ç—Ç–æ–≥–æ URL.'
        },
        { 
          id: 'admin-get-webhooks-url', 
          description: 'URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –∏–º–ø–æ—Ä—Ç–∞.'
        },
        { 
          id: 'admin-content-webhook-url', 
          description: 'URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç GET-–∑–∞–ø—Ä–æ—Å –Ω–∞ —ç—Ç–æ—Ç URL –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π Markdown –∏–ª–∏ HTML.'
        },
        { 
          id: 'admin-test-webhook-url', 
          description: 'URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Å—Ç–∞. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç GET-–∑–∞–ø—Ä–æ—Å –Ω–∞ —ç—Ç–æ—Ç URL –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç.'
        }
      ];

      webhookFields.forEach(field => {
        const input = document.getElementById(field.id);
        if (input) {
          const label = input.previousElementSibling;
          if (label) {
            const infoBadge = document.createElement('span');
            infoBadge.className = 'dev-info-badge';
            infoBadge.textContent = 'i';
            infoBadge.setAttribute('data-tooltip', field.description);
            infoBadge.addEventListener('click', (e) => {
              e.stopPropagation();
              this.showInfoTooltip(e.target, field.description);
            });
            label.appendChild(infoBadge);
          }
        }
      });
    }

    removeInfoBadgesFromAdminForms() {
      document.querySelectorAll('.dev-info-badge').forEach(badge => {
        badge.remove();
      });
      document.querySelectorAll('.dev-info-tooltip').forEach(tooltip => {
        tooltip.remove();
      });
    }

    showInfoTooltip(element, text) {
      document.querySelectorAll('.dev-info-tooltip').forEach(tooltip => {
        tooltip.remove();
      });
      const tooltip = document.createElement('div');
      tooltip.className = 'dev-info-tooltip';
      tooltip.textContent = text;
      tooltip.style.left = `${element.offsetLeft + element.offsetWidth + 5}px`;
      tooltip.style.top = `${element.offsetTop - 5}px`;
      document.body.appendChild(tooltip);
      document.addEventListener('click', function closeTooltip(e) {
        if (e.target !== tooltip && e.target !== element) {
          tooltip.remove();
          document.removeEventListener('click', closeTooltip);
        }
      });
      setTimeout(() => {
        tooltip.classList.add('visible');
      }, 10);
    }

    clearLogs() {
      this.logs = [];
      document.getElementById('dev-panel-logs').innerHTML = '';
    }

    truncateString(str, maxLength) {
      if (str.length <= maxLength) return str;
      return str.substring(0, maxLength) + '...';
    }

    async syncWithCloud() {
      const webhookSettingsStr = localStorage.getItem('webhookSettings');
      if (!webhookSettingsStr) {
        this.logMessage('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage', 'error');
        return;
      }
      try {
        const webhookSettings = JSON.parse(webhookSettingsStr);
        if (webhookSettings.importUrl) {
          this.logMessage(`–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º. URL –∏–º–ø–æ—Ä—Ç–∞: ${webhookSettings.importUrl}`, 'info');
          try {
            const response = await fetch(webhookSettings.importUrl, {
              method: 'GET',
              headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
              }
            });
            if (response.ok) {
              const contentType = response.headers.get('content-type') || '';
              this.logMessage(`–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç —Å Content-Type: ${contentType}`, 'info');
              const text = await response.text();
              this.logMessage(`–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ (${text.length} —Å–∏–º–≤–æ–ª–æ–≤)`, 'info');
              let data;
              try {
                data = JSON.parse(text);
                this.logMessage('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω—ã –∫–∞–∫ JSON', 'success');
              } catch (e) {
                this.logMessage(`–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON: ${e.message}`, 'warning');
                if (text.includes('"data"')) {
                  try {
                    const regex = /"data"\s*:\s*"(.*?)"/s;
                    const match = text.match(regex);
                    if (match && match[1]) {
                      let jsonString = match[1].replace(/\\"/g, '"').replace(/\\n/g, '\n').replace(/\\\\/g, '\\');
                      while (jsonString.includes('\\')) {
                        jsonString = jsonString.replace(/\\"/g, '"').replace(/\\n/g, '\n').replace(/\\\\/g, '\\');
                      }
                      this.logMessage('–ò–∑–≤–ª–µ—á–µ–Ω JSON –∏–∑ –ø–æ–ª—è "data"', 'info');
                      data = { courses: JSON.parse(jsonString) };
                    }
                  } catch (innerError) {
                    this.logMessage(`–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–ª—è data: ${innerError.message}`, 'error');
                  }
                }
              }
              if (!data) {
                this.logMessage('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞.', 'error');
                return;
              }
              if (!data.courses) {
                if (typeof data === 'object' && Object.keys(data).length > 0) {
                  const courseCandidate = Object.values(data).find(item => 
                    item && typeof item === 'object' && 
                    (item.days || item.specialLessons || item.title)
                  );
                  if (courseCandidate) {
                    this.logMessage('–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –∫–∞–∫ courses', 'info');
                    data = { courses: data };
                  }
                }
                if (!data.courses) {
                  this.logMessage('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫—É—Ä—Å–∞—Ö', 'error');
                  return;
                }
              }
              const courseCount = Object.keys(data.courses).length;
              this.logMessage(`–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ–≤ (${courseCount} –∫—É—Ä—Å–æ–≤)`, 'success');
              this.logMessage(`–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∫—É—Ä—Å–æ–≤: ${Object.keys(data.courses).join(', ')}`, 'info');
              const backupCourses = JSON.parse(JSON.stringify(window.courseManager.courses));
              try {
                window.courseManager.courses = data.courses;
                this.logMessage('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã', 'success');
                if (window.adminInterface && window.adminInterface.loadCoursesList) {
                  window.adminInterface.loadCoursesList();
                }
                localStorage.setItem('coursesBackup', JSON.stringify(backupCourses));
                localStorage.setItem('coursesBackupTimestamp', new Date().toISOString());
                if (window.adminInterface && window.adminInterface.exportDataToWebhook) {
                  this.logMessage(`–≠–∫—Å–ø–æ—Ä—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ ${webhookSettings.exportUrl}`, 'info');
                  window.adminInterface.exportDataToWebhook(webhookSettings.exportUrl);
                }
              } catch (e) {
                window.courseManager.courses = backupCourses;
                this.logMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: ${e.message}`, 'error');
                this.logMessage('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è –∫—É—Ä—Å–æ–≤', 'warning');
              }
            } else {
              this.logMessage(`–û—à–∏–±–∫–∞ HTTP! –°—Ç–∞—Ç—É—Å: ${response.status}`, 'error');
            }
          } catch (error) {
            this.logMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –æ–±–ª–∞–∫–æ–º: ${error.message}`, 'error');
          }
        } else {
          this.logMessage('URL –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–µ–±—Ö—É–∫–æ–≤', 'error');
        }
      } catch (e) {
        this.logMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤: ${e.message}`, 'error');
      }
    }

    logMessage(message, type = 'info') {
      const logsContainer = document.getElementById('dev-panel-logs');
      if (!logsContainer) return;
      const timestamp = new Date().toLocaleTimeString();
      let typeClass;
      switch (type) {
        case 'success': typeClass = 'success'; break;
        case 'error': typeClass = 'error'; break;
        case 'warning': typeClass = 'warning'; break;
        default: typeClass = 'info';
      }
      const logEntry = document.createElement('div');
      logEntry.className = 'dev-log-entry';
      logEntry.innerHTML = `
        <div class="dev-log-entry-header">
          <span class="dev-log-message ${typeClass}">${message}</span>
          <span class="dev-log-timestamp">${timestamp}</span>
        </div>
      `;
      logsContainer.prepend(logEntry);
      console.log(`üîß [DevMode] ${message}`);
    }

    showDebugInfo() {
      if (!window.courseManager) {
        this.logMessage('CourseManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
        return;
      }
      this.logMessage(`–¢–µ–∫—É—â–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è: ${window.courseManager.currentProfession || '–Ω–µ –≤—ã–±—Ä–∞–Ω–∞'}`, 'info');
      this.logMessage(`–¢–µ–∫—É—â–∏–π –¥–µ–Ω—å: ${window.courseManager.currentDay ? window.courseManager.currentDay.id : '–Ω–µ –≤—ã–±—Ä–∞–Ω'}`, 'info');
      this.logMessage(`–¢–µ–∫—É—â–∏–π —É—Ä–æ–∫: ${window.courseManager.currentLesson ? window.courseManager.currentLesson.id : '–Ω–µ –≤—ã–±—Ä–∞–Ω'}`, 'info');
      const daySelectionContainer = document.getElementById('day-selection');
      const taskSelectionContainer = document.getElementById('task-selection');
      const homeContainer = document.getElementById('home');
      const guideContainer = document.getElementById('guide');
      this.logMessage(`–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ DOM:`, 'info');
      this.logMessage(`- home: ${homeContainer ? (homeContainer.classList.contains('hidden') ? '—Å–∫—Ä—ã—Ç' : '–≤–∏–¥–µ–Ω') : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}`, 'info');
      this.logMessage(`- day-selection: ${daySelectionContainer ? (daySelectionContainer.classList.contains('hidden') ? '—Å–∫—Ä—ã—Ç' : '–≤–∏–¥–µ–Ω') : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}`, 'info');
      this.logMessage(`- task-selection: ${taskSelectionContainer ? (taskSelectionContainer.classList.contains('hidden') ? '—Å–∫—Ä—ã—Ç' : '–≤–∏–¥–µ–Ω') : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}`, 'info');
      this.logMessage(`- guide: ${guideContainer ? (guideContainer.classList.contains('hidden') ? '—Å–∫—Ä—ã—Ç' : '–≤–∏–¥–µ–Ω') : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}`, 'info');
      const days = window.courseManager.getDays();
      this.logMessage(`–î–æ—Å—Ç—É–ø–Ω–æ –¥–Ω–µ–π: ${days ? days.length : 0}`, 'info');
      if (days && days.length > 0) {
        days.forEach((day, index) => {
          this.logMessage(`–î–µ–Ω—å ${index+1}: ID=${day.id}, title=${day.title}, —É—Ä–æ–∫–æ–≤: ${day.lessons ? day.lessons.length : 0}`, 'info');
        });
      }
    }

    showLocalStorageManager() {
      const storageReport = document.createElement('div');
      storageReport.className = 'dev-storage-report';
      const keys = Object.keys(localStorage);
      const totalSize = this.calculateLocalStorageSize();
      const summaryInfo = document.createElement('div');
      summaryInfo.className = 'dev-summary-info';
      summaryInfo.style.backgroundColor = 'rgba(0, 0, 0, 0.2)';
      summaryInfo.style.padding = '10px';
      summaryInfo.style.borderRadius = '4px';
      summaryInfo.style.marginBottom = '15px';
      const buttonsContainer = document.createElement('div');
      buttonsContainer.style.marginBottom = '10px';
      buttonsContainer.style.display = 'flex';
      buttonsContainer.style.gap = '10px';
      const clearAllButton = document.createElement('button');
      clearAllButton.innerText = '–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å LocalStorage';
      clearAllButton.style.backgroundColor = '#e06c75';
      clearAllButton.style.color = 'white';
      clearAllButton.style.border = 'none';
      clearAllButton.style.padding = '8px 15px';
      clearAllButton.style.borderRadius = '4px';
      clearAllButton.style.cursor = 'pointer';
      clearAllButton.onclick = () => {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å LocalStorage? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
          localStorage.clear();
          this.logMessage('LocalStorage –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω', 'success');
          this.showLocalStorageManager();
        }
      };
      const refreshButton = document.createElement('button');
      refreshButton.innerText = '–û–±–Ω–æ–≤–∏—Ç—å';
      refreshButton.style.backgroundColor = '#61afef';
      refreshButton.style.color = 'white';
      refreshButton.style.border = 'none';
      refreshButton.style.padding = '8px 15px';
      refreshButton.style.borderRadius = '4px';
      refreshButton.style.cursor = 'pointer';
      refreshButton.onclick = () => {
        this.showLocalStorageManager();
      };
      buttonsContainer.appendChild(refreshButton);
      buttonsContainer.appendChild(clearAllButton);
      summaryInfo.appendChild(buttonsContainer);
      summaryInfo.innerHTML += `
        <div style="font-weight: bold; color: #56b6c2; margin-bottom: 5px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ LocalStorage:</div>
        <div><span style="color: #d19a66;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:</span> ${keys.length}</div>
        <div><span style="color: #d19a66;">–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:</span> ${totalSize} KB</div>
        <div><span style="color: #d19a66;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:</span> ${((totalSize / 5120) * 100).toFixed(2)}% (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)</div>
      `;
      storageReport.appendChild(summaryInfo);
      const table = document.createElement('table');
      table.className = 'dev-storage-table';
      table.style.width = '100%';
      table.style.borderCollapse = 'collapse';
      table.style.marginBottom = '15px';
      table.style.fontSize = '12px';
      const thead = document.createElement('thead');
      thead.innerHTML = `
        <tr style="background-color: #1e2127; color: #ddd;">
          <th style="padding: 8px; text-align: left; border-bottom: 1px solid #444;">–ö–ª—é—á</th>
          <th style="padding: 8px; text-align: left; border-bottom: 1px solid #444;">–¢–∏–ø</th>
          <th style="padding: 8px; text-align: right; border-bottom: 1px solid #444;">–†–∞–∑–º–µ—Ä</th>
          <th style="padding: 8px; text-align: center; border-bottom: 1px solid #444;">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      `;
      table.appendChild(thead);
      const tbody = document.createElement('tbody');
      keys.sort((a, b) => {
        const sizeA = localStorage.getItem(a).length;
        const sizeB = localStorage.getItem(b).length;
        return sizeB - sizeA;
      });
      keys.forEach(key => {
        const value = localStorage.getItem(key);
        const size = value.length;
        const sizeKB = (size / 1024).toFixed(2);
        let type = '–¢–µ–∫—Å—Ç';
        let isJSON = false;
        try {
          const parsed = JSON.parse(value);
          type = typeof parsed === 'object' ? 'JSON' : typeof parsed;
          isJSON = typeof parsed === 'object';
        } catch (e) {}
        const tr = document.createElement('tr');
        tr.style.borderBottom = '1px solid rgba(255, 255, 255, 0.1)';
        tr.innerHTML = `
          <td style="padding: 8px;">${key}</td>
          <td style="padding: 8px; color: ${type === 'JSON' ? '#98c379' : '#e5c07b'};">${type}</td>
          <td style="padding: 8px; text-align: right;">${sizeKB} KB</td>
          <td style="padding: 8px; text-align: center;">
            <button class="dev-storage-view-btn" data-key="${key}" style="background-color: #56b6c2; color: white; border: none; border-radius: 3px; padding: 3px 8px; margin-right: 5px; cursor: pointer;">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
            <button class="dev-storage-edit-btn" data-key="${key}" data-is-json="${isJSON}" style="background-color: #98c379; color: white; border: none; border-radius: 3px; padding: 3px 8px; margin-right: 5px; cursor: pointer;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="dev-storage-delete-btn" data-key="${key}" style="background-color: #e06c75; color: white; border: none; border-radius: 3px; padding: 3px 8px; cursor: pointer;">–£–¥–∞–ª–∏—Ç—å</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      storageReport.appendChild(table);
      const logEntry = document.createElement('div');
      logEntry.className = 'dev-log-entry';
      logEntry.style.padding = '10px';
      const timestamp = new Date().toLocaleTimeString();
      logEntry.innerHTML = `
        <div class="dev-log-entry-header">
          <span class="dev-log-message info">–ú–µ–Ω–µ–¥–∂–µ—Ä LocalStorage</span>
          <span class="dev-log-timestamp">${timestamp}</span>
        </div>
        <div style="margin-top: 10px;" id="storage-view-container">
          ${storageReport.outerHTML}
        </div>
      `;
      const logsContainer = document.getElementById('dev-panel-logs');
      if (logsContainer) {
        logsContainer.prepend(logEntry);
        this.setupStorageEventHandlers();
        logEntry.scrollIntoView({ behavior: 'smooth' });
      }
      this.logMessage('–ú–µ–Ω–µ–¥–∂–µ—Ä LocalStorage –æ—Ç–∫—Ä—ã—Ç', 'info');
    }

    setupStorageEventHandlers() {
      document.querySelectorAll('.dev-storage-view-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const key = e.target.getAttribute('data-key');
          const value = localStorage.getItem(key);
          this.showStorageItemDetails(key, value);
        });
      });
      document.querySelectorAll('.dev-storage-edit-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const key = e.target.getAttribute('data-key');
          const isJSON = e.target.getAttribute('data-is-json') === 'true';
          const value = localStorage.getItem(key);
          this.editStorageItem(key, value, isJSON);
        });
      });
      document.querySelectorAll('.dev-storage-delete-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const key = e.target.getAttribute('data-key');
          if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç "${key}" –∏–∑ LocalStorage?`)) {
            localStorage.removeItem(key);
            this.logMessage(`–≠–ª–µ–º–µ–Ω—Ç "${key}" —É–¥–∞–ª–µ–Ω –∏–∑ LocalStorage`, 'success');
            this.showLocalStorageManager();
          }
        });
      });
    }

    showStorageItemDetails(key, value) {
      const viewContainer = document.createElement('div');
      viewContainer.className = 'dev-storage-view-container';
      viewContainer.style.padding = '10px';
      viewContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
      viewContainer.style.borderRadius = '4px';
      viewContainer.style.marginTop = '10px';
      const header = document.createElement('div');
      header.style.display = 'flex';
      header.style.justifyContent = 'space-between';
      header.style.alignItems = 'center';
      header.style.marginBottom = '10px';
      header.innerHTML = `
        <h3 style="margin: 0; color: #56b6c2;">–ü—Ä–æ—Å–º–æ—Ç—Ä —ç–ª–µ–º–µ–Ω—Ç–∞: ${key}</h3>
        <button id="close-storage-view" style="background: none; border: none; color: #aaa; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      `;
      viewContainer.appendChild(header);
      let formattedValue = value;
      try {
        const parsedValue = JSON.parse(value);
        formattedValue = this.formatJson(parsedValue);
      } catch (e) {
        formattedValue = `<pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">${this.escapeHtml(value)}</pre>`;
      }
      const content = document.createElement('div');
      content.style.maxHeight = '400px';
      content.style.overflow = 'auto';
      content.style.backgroundColor = 'rgba(0, 0, 0, 0.2)';
      content.style.padding = '10px';
      content.style.borderRadius = '3px';
      content.innerHTML = formattedValue;
      viewContainer.appendChild(content);
      const actions = document.createElement('div');
      actions.style.marginTop = '10px';
      actions.style.display = 'flex';
      actions.style.gap = '10px';
      const copyButton = document.createElement('button');
      copyButton.innerText = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
      copyButton.style.backgroundColor = '#61afef';
      copyButton.style.color = 'white';
      copyButton.style.border = 'none';
      copyButton.style.padding = '5px 10px';
      copyButton.style.borderRadius = '3px';
      copyButton.style.cursor = 'pointer';
      copyButton.addEventListener('click', () => {
        navigator.clipboard.writeText(value).then(() => {
          this.logMessage(`–ó–Ω–∞—á–µ–Ω–∏–µ –∫–ª—é—á–∞ "${key}" —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞`, 'success');
        }).catch(err => {
          this.logMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏: ${err}`, 'error');
        });
      });
      actions.appendChild(copyButton);
      viewContainer.appendChild(actions);
      const logEntry = document.createElement('div');
      logEntry.className = 'dev-log-entry';
      logEntry.style.padding = '10px';
      const timestamp = new Date().toLocaleTimeString();
      logEntry.innerHTML = `
        <div class="dev-log-entry-header">
          <span class="dev-log-message info">–ü—Ä–æ—Å–º–æ—Ç—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ LocalStorage</span>
          <span class="dev-log-timestamp">${timestamp}</span>
        </div>
        <div style="margin-top: 10px;" id="storage-view-container">
          ${viewContainer.outerHTML}
        </div>
      `;
      const logsContainer = document.getElementById('dev-panel-logs');
      if (logsContainer) {
        logsContainer.prepend(logEntry);
        document.getElementById('close-storage-view').addEventListener('click', () => {
          logEntry.remove();
        });
        logEntry.scrollIntoView({ behavior: 'smooth' });
      }
    }

    editStorageItem(key, value, isJSON) {
      const editContainer = document.createElement('div');
      editContainer.className = 'dev-storage-edit-container';
      editContainer.style.padding = '10px';
      editContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
      editContainer.style.borderRadius = '4px';
      editContainer.style.marginTop = '10px';
      const header = document.createElement('div');
      header.style.display = 'flex';
      header.style.justifyContent = 'space-between';
      header.style.alignItems = 'center';
      header.style.marginBottom = '10px';
      header.innerHTML = `
        <h3 style="margin: 0; color: #98c379;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞: ${key}</h3>
        <button id="close-storage-edit" style="background: none; border: none; color: #aaa; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      `;
      editContainer.appendChild(header);
      let formattedValue = value;
      if (isJSON) {
        try {
          const parsedValue = JSON.parse(value);
          formattedValue = JSON.stringify(parsedValue, null, 2);
        } catch (e) {}
      }
      const textarea = document.createElement('textarea');
      textarea.id = 'storage-edit-textarea';
      textarea.style.width = '100%';
      textarea.style.height = '300px';
      textarea.style.backgroundColor = 'rgba(30, 33, 39, 0.9)';
      textarea.style.color = '#eee';
      textarea.style.border = '1px solid #444';
      textarea.style.borderRadius = '3px';
      textarea.style.padding = '10px';
      textarea.style.fontFamily = 'Consolas, Monaco, monospace';
      textarea.style.fontSize = '12px';
      textarea.value = formattedValue;
      editContainer.appendChild(textarea);
      const actions = document.createElement('div');
      actions.style.marginTop = '10px';
      actions.style.display = 'flex';
      actions.style.gap = '10px';
      const saveButton = document.createElement('button');
      saveButton.innerText = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
      saveButton.style.backgroundColor = '#98c379';
      saveButton.style.color = 'white';
      saveButton.style.border = 'none';
      saveButton.style.padding = '5px 10px';
      saveButton.style.borderRadius = '3px';
      saveButton.style.cursor = 'pointer';
      const formatButton = document.createElement('button');
      formatButton.innerText = '–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å JSON';
      formatButton.style.backgroundColor = '#61afef';
      formatButton.style.color = 'white';
      formatButton.style.border = 'none';
      formatButton.style.padding = '5px 10px';
      formatButton.style.borderRadius = '3px';
      formatButton.style.cursor = 'pointer';
      formatButton.addEventListener('click', () => {
        try {
          const parsedValue = JSON.parse(textarea.value);
          textarea.value = JSON.stringify(parsedValue, null, 2);
          this.logMessage('JSON —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
        } catch (e) {
          this.logMessage(`–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${e.message}`, 'error');
        }
      });
      saveButton.addEventListener('click', () => {
        try {
          if (isJSON) {
            JSON.parse(textarea.value);
          }
          localStorage.setItem(key, textarea.value);
          this.logMessage(`–≠–ª–µ–º–µ–Ω—Ç "${key}" —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω`, 'success');
          document.getElementById('storage-edit-entry')?.remove();
          this.showLocalStorageManager();
        } catch (e) {
          this.logMessage(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${e.message}`, 'error');
        }
      });
      if (isJSON) {
        actions.appendChild(formatButton);
      }
      actions.appendChild(saveButton);
      editContainer.appendChild(actions);
      const logEntry = document.createElement('div');
      logEntry.id = 'storage-edit-entry';
      logEntry.className = 'dev-log-entry';
      logEntry.style.padding = '10px';
      const timestamp = new Date().toLocaleTimeString();
      logEntry.innerHTML = `
        <div class="dev-log-entry-header">
          <span class="dev-log-message info">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ LocalStorage</span>
          <span class="dev-log-timestamp">${timestamp}</span>
        </div>
        <div style="margin-top: 10px;" id="storage-edit-container">
          ${editContainer.outerHTML}
        </div>
      `;
      const logsContainer = document.getElementById('dev-panel-logs');
      if (logsContainer) {
        logsContainer.prepend(logEntry);
        document.getElementById('close-storage-edit').addEventListener('click', () => {
          logEntry.remove();
        });
        logEntry.scrollIntoView({ behavior: 'smooth' });
      }
    }

    calculateLocalStorageSize() {
      let total = 0;
      Object.keys(localStorage).forEach(key => {
        const value = localStorage.getItem(key);
        total += (key.length + value.length) * 2;
      });
      return (total / 1024).toFixed(2);
    }

    escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    analyzeAndDisplayCourses() {
      if (!window.courseManager || !window.courseManager.courses) {
        this.logMessage('–î–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', 'error');
        return;
      }
      this.showDebugInfo();
      const courses = window.courseManager.courses;
      const courseIds = Object.keys(courses);
      this.logMessage(`–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö: –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${courseIds.length} –∫—É—Ä—Å–æ–≤`, 'info');
      const detailedReport = document.createElement('div');
      detailedReport.className = 'dev-detailed-report';
      let totalLessons = 0;
      let totalWebhooks = 0;
      let webhookUrls = [];
      courseIds.forEach(courseId => {
        const course = courses[courseId];
        const courseSection = document.createElement('div');
        courseSection.className = 'dev-course-section';
        let courseInfo = `<h3 style="color: #56b6c2; margin: 10px 0;">–ö—É—Ä—Å: ${course.title || courseId}</h3>`;
        if (course.redirectUrl) {
          courseInfo += `<div><span style="color: #d19a66;">–†–µ–¥–∏—Ä–µ–∫—Ç URL:</span> ${course.redirectUrl}</div>`;
        }
        let daysList = '';
        let lessonCount = 0;
        let courseWebhooks = 0;
        if (course.days && Array.isArray(course.days)) {
          course.days.forEach((day, dayIndex) => {
            daysList += `<div style="margin-top: 8px;"><span style="color: #e5c07b;">–î–µ–Ω—å ${day.id}:</span> ${day.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>`;
            if (day.lessons && Array.isArray(day.lessons)) {
              daysList += `<ul style="margin-top: 2px; padding-left: 20px;">`;
              day.lessons.forEach((lesson, lessonIndex) => {
                lessonCount++;
                totalLessons++;
                let lessonInfo = `<li><span style="color: #98c379;">–£—Ä–æ–∫ ${lesson.id}:</span> ${lesson.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}`;
                if (lesson.contentSource) {
                  if (lesson.contentSource.type === 'webhook') {
                    lessonInfo += ` <span style="color: #61afef;">[–≤–µ–±—Ö—É–∫]</span>`;
                    courseWebhooks++;
                    totalWebhooks++;
                    webhookUrls.push(lesson.contentSource.url);
                  } else if (lesson.contentSource.type === 'local') {
                    lessonInfo += ` <span style="color: #c678dd;">[–ª–æ–∫–∞–ª—å–Ω—ã–π]</span>`;
                  } else if (lesson.contentSource.type === 'markdown') {
                    lessonInfo += ` <span style="color: #56b6c2;">[–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π]</span>`;
                  }
                } else {
                  lessonInfo += ` <span style="color: #e06c75;">[–Ω–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞]</span>`;
                }
                if (lesson.testSource) {
                  lessonInfo += ` <span style="color: #98c379;">[—Ç–µ—Å—Ç]</span>`;
                }
                if (lesson.audioSource) {
                  lessonInfo += ` <span style="color: #d19a66;">[–∞—É–¥–∏–æ]</span>`;
                }
                lessonInfo += `</li>`;
                daysList += lessonInfo;
              });
              daysList += `</ul>`;
            } else {
              daysList += `<div style="color: #e06c75; padding-left: 15px;">–£—Ä–æ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>`;
            }
          });
        } else {
          daysList = `<div style="color: #e06c75;">–î–Ω–∏ –æ–±—É—á–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>`;
        }
        let specialLessonsList = '';
        if (course.specialLessons && Array.isArray(course.specialLessons)) {
          specialLessonsList += `<div style="margin-top: 10px;"><span style="color: #c678dd;">–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ä–æ–∫–∏:</span></div>`;
          specialLessonsList += `<ul style="margin-top: 2px; padding-left: 20px;">`;
          course.specialLessons.forEach((lesson, lessonIndex) => {
            lessonCount++;
            totalLessons++;
            let lessonInfo = `<li><span style="color: #98c379;">–£—Ä–æ–∫ ${lesson.id}:</span> ${lesson.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}`;
            if (lesson.contentSource) {
              if (lesson.contentSource.type === 'webhook') {
                lessonInfo += ` <span style="color: #61afef;">[–≤–µ–±—Ö—É–∫]</span>`;
                courseWebhooks++;
                totalWebhooks++;
                webhookUrls.push(lesson.contentSource.url);
              } else if (lesson.contentSource.type === 'local') {
                lessonInfo += ` <span style="color: #c678dd;">[–ª–æ–∫–∞–ª—å–Ω—ã–π]</span>`;
              } else if (lesson.contentSource.type === 'markdown') {
                lessonInfo += ` <span style="color: #56b6c2;">[–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π]</span>`;
              }
            } else {
              lessonInfo += ` <span style="color: #e06c75;">[–Ω–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞]</span>`;
            }
            if (lesson.testSource) {
              lessonInfo += ` <span style="color: #98c379;">[—Ç–µ—Å—Ç]</span>`;
            }
            if (lesson.audioSource) {
              lessonInfo += ` <span style="color: #d19a66;">[–∞—É–¥–∏–æ]</span>`;
            }
            lessonInfo += `</li>`;
            specialLessonsList += lessonInfo;
          });
          specialLessonsList += `</ul>`;
        }
        let noDayLessonsList = '';
        if (course.noDayLessons && Array.isArray(course.noDayLessons)) {
          noDayLessonsList += `<div style="margin-top: 10px;"><span style="color: #c678dd;">–£—Ä–æ–∫–∏ –±–µ–∑ –¥–Ω–µ–π:</span></div>`;
          noDayLessonsList += `<ul style="margin-top: 2px; padding-left: 20px;">`;
          course.noDayLessons.forEach((lesson, lessonIndex) => {
            lessonCount++;
            totalLessons++;
            let lessonInfo = `<li><span style="color: #98c379;">–£—Ä–æ–∫ ${lesson.id}:</span> ${lesson.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}`;
            if (lesson.contentSource) {
              if (lesson.contentSource.type === 'webhook') {
                lessonInfo += ` <span style="color: #61afef;">[–≤–µ–±—Ö—É–∫]</span>`;
                courseWebhooks++;
                totalWebhooks++;
                webhookUrls.push(lesson.contentSource.url);
              } else if (lesson.contentSource.type === 'local') {
                lessonInfo += ` <span style="color: #c678dd;">[–ª–æ–∫–∞–ª—å–Ω—ã–π]</span>`;
              } else if (lesson.contentSource.type === 'markdown') {
                lessonInfo += ` <span style="color: #56b6c2;">[–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π]</span>`;
              }
            } else {
              lessonInfo += ` <span style="color: #e06c75;">[–Ω–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞]</span>`;
            }
            if (lesson.testSource) {
              lessonInfo += ` <span style="color: #98c379;">[—Ç–µ—Å—Ç]</span>`;
            }
            if (lesson.audioSource) {
              lessonInfo += ` <span style="color: #d19a66;">[–∞—É–¥–∏–æ]</span>`;
            }
            lessonInfo += `</li>`;
            noDayLessonsList += lessonInfo;
          });
          noDayLessonsList += `</ul>`;
        }
        courseInfo += `<div><span style="color: #d19a66;">–í—Å–µ–≥–æ —É—Ä–æ–∫–æ–≤:</span> ${lessonCount}</div>`;
        courseInfo += `<div><span style="color: #d19a66;">–£—Ä–æ–∫–æ–≤ —Å –≤–µ–±—Ö—É–∫–∞–º–∏:</span> ${courseWebhooks}</div>`;
        courseInfo += daysList;
        courseInfo += specialLessonsList;
        courseInfo += noDayLessonsList;
        courseSection.innerHTML = courseInfo;
        detailedReport.appendChild(courseSection);
        if (courseIds.indexOf(courseId) < courseIds.length - 1) {
          const divider = document.createElement('div');
          divider.style.height = '1px';
          divider.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
          divider.style.margin = '15px 0';
          detailedReport.appendChild(divider);
        }
      });
      const testWebhooksButton = document.createElement('button');
      testWebhooksButton.innerText = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ–±—Ö—É–∫–∏';
      testWebhooksButton.style.backgroundColor = '#007bff';
      testWebhooksButton.style.color = 'white';
      testWebhooksButton.style.border = 'none';
      testWebhooksButton.style.padding = '8px 15px';
      testWebhooksButton.style.borderRadius = '4px';
      testWebhooksButton.style.cursor = 'pointer';
      testWebhooksButton.style.margin = '10px 0';
      testWebhooksButton.onclick = async () => {
        if (!webhookUrls || webhookUrls.length === 0) {
          this.logMessage('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏', 'warning');
          return;
        }
        const webhooksToTest = webhookUrls.slice(0, 3);
        this.logMessage(`–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É ${webhooksToTest.length} –≤–µ–±—Ö—É–∫–æ–≤...`, 'info');
        for (let i = 0; i < webhooksToTest.length; i++) {
          const url = webhooksToTest[i];
          this.logMessage(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±—Ö—É–∫–∞ ${i+1}/${webhooksToTest.length}: ${url}`, 'info');
          try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 10000);
            const response = await fetch(url, {
              method: 'GET',
              headers: {
                'Accept': 'text/plain, text/markdown, text/html, application/json, */*',
                'Cache-Control': 'no-cache'
              },
              mode: 'cors',
              cache: 'no-store',
              signal: controller.signal
            });
            clearTimeout(timeoutId);
            if (response.ok) {
              const contentType = response.headers.get('content-type') || '';
              const text = await response.text();
              this.logMessage(`–í–µ–±—Ö—É–∫ ${i+1} –æ—Ç–≤–µ—Ç–∏–ª —É—Å–ø–µ—à–Ω–æ! –°—Ç–∞—Ç—É—Å: ${response.status}, Content-Type: ${contentType}, –†–∞–∑–º–µ—Ä: ${text.length} –±–∞–π—Ç`, 'success');
            } else {
              this.logMessage(`–í–µ–±—Ö—É–∫ ${i+1} –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: HTTP ${response.status}`, 'error');
            }
          } catch (error) {
            this.logMessage(`–í–µ–±—Ö—É–∫ ${i+1} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`, 'error');
          }
        }
      };
      const summaryInfo = document.createElement('div');
      summaryInfo.className = 'dev-summary-info';
      summaryInfo.style.backgroundColor = 'rgba(0, 0, 0, 0.2)';
      summaryInfo.style.padding = '10px';
      summaryInfo.style.borderRadius = '4px';
      summaryInfo.style.marginBottom = '15px';
      summaryInfo.appendChild(testWebhooksButton);
      summaryInfo.innerHTML = `
        <div style="font-weight: bold; color: #56b6c2; margin-bottom: 5px;">–°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</div>
        <div><span style="color: #d19a66;">–í—Å–µ–≥–æ –∫—É—Ä—Å–æ–≤:</span> ${courseIds.length}</div>
        <div><span style="color: #d19a66;">–í—Å–µ–≥–æ —É—Ä–æ–∫–æ–≤:</span> ${totalLessons}</div>
        <div><span style="color: #d19a66;">–£—Ä–æ–∫–æ–≤ —Å –≤–µ–±—Ö—É–∫–∞–º–∏:</span> ${totalWebhooks}</div>
      `;
      if (webhookUrls.length > 0) {
        let webhookList = `<div style="margin-top: 5px;"><span style="color: #d19a66;">–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ URL –≤–µ–±—Ö—É–∫–æ–≤:</span></div><ul style="margin-top: 2px; padding-left: 20px;">`;
        const uniqueWebhooks = [...new Set(webhookUrls)];
        uniqueWebhooks.forEach(url => {
          const count = webhookUrls.filter(u => u === url).length;
          webhookList += `<li style="color: #61afef; word-break: break-all;">${url} <span style="color: #98c379;">(–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ${count} —Ä–∞–∑)</span></li>`;
        });
        webhookList += `</ul>`;
        summaryInfo.innerHTML += webhookList;
      }
      const webhookSettingsStr = localStorage.getItem('webhookSettings');
      if (webhookSettingsStr) {
        try {
          const webhookSettings = JSON.parse(webhookSettingsStr);
          let settingsInfo = `<div style="margin-top: 10px;"><span style="color: #d19a66;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤:</span></div><ul style="margin-top: 2px; padding-left: 20px;">`;
          if (webhookSettings.importUrl) {
            settingsInfo += `<li><span style="color: #98c379;">URL –∏–º–ø–æ—Ä—Ç–∞:</span> <span style="color: #61afef; word-break: break-all;">${webhookSettings.importUrl}</span></li>`;
          }
          if (webhookSettings.exportUrl) {
            settingsInfo += `<li><span style="color: #98c379;">URL —ç–∫—Å–ø–æ—Ä—Ç–∞:</span> <span style="color: #61afef; word-break: break-all;">${webhookSettings.exportUrl}</span></li>`;
          }
          if (webhookSettings.contentWebhookUrl) {
            settingsInfo += `<li><span style="color: #98c379;">URL –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</span> <span style="color: #61afef; word-break: break-all;">${webhookSettings.contentWebhookUrl}</span></li>`;
          }
          if (webhookSettings.testWebhookUrl) {
            settingsInfo += `<li><span style="color: #98c379;">URL —Ç–µ—Å—Ç–æ–≤:</span> <span style="color: #61afef; word-break: break-all;">${webhookSettings.testWebhookUrl}</span></li>`;
          }
          settingsInfo += `</ul>`;
          summaryInfo.innerHTML += settingsInfo;
        } catch (e) {
          this.logMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤: ${e.message}`, 'error');
        }
      }
      const backupTimestamp = localStorage.getItem('coursesBackupTimestamp');
      if (backupTimestamp) {
        const date = new Date(backupTimestamp);
        const formattedDate = date.toLocaleString();
        summaryInfo.innerHTML += `<div style="margin-top: 5px;"><span style="color: #d19a66;">–ü–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø:</span> ${formattedDate}</div>`;
      }
      detailedReport.insertBefore(summaryInfo, detailedReport.firstChild);
      const logEntry = document.createElement('div');
      logEntry.className = 'dev-log-entry';
      logEntry.style.padding = '10px';
      const timestamp = new Date().toLocaleTimeString();
      logEntry.innerHTML = `
        <div class="dev-log-entry-header">
          <span class="dev-log-message info">–ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –∏ –≤–µ–±—Ö—É–∫–æ–≤</span>
          <span class="dev-log-timestamp">${timestamp}</span>
        </div>
        <div style="margin-top: 10px;">
          ${detailedReport.outerHTML}
        </div>
      `;
      const logsContainer = document.getElementById('dev-panel-logs');
      if (logsContainer) {
        logsContainer.prepend(logEntry);
        logEntry.scrollIntoView({ behavior: 'smooth' });
      }
      console.log(`üîß [DevMode] –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ —Å–æ–∑–¥–∞–Ω (${totalLessons} —É—Ä–æ–∫–æ–≤, ${totalWebhooks} –≤–µ–±—Ö—É–∫–æ–≤)`);
    }
  }

  // –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
  const devMode = new DevMode();
  document.addEventListener('DOMContentLoaded', () => {
    if (!document.querySelector('link[href*="font-awesome"]')) {
      const fontAwesome = document.createElement('link');
      fontAwesome.rel = 'stylesheet';
      fontAwesome.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css';
      document.head.appendChild(fontAwesome);
    }
    devMode.initialize();
  });
  window.devMode = devMode;
  window.devMode = devMode;
  // ==================== END DEV MODE CODE ====================


  // ==================== BEGIN ADMIN CODE ====================
  /**
   * –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–∞–º–∏
   * 
   * –ü–æ–∑–≤–æ–ª—è–µ—Ç:
   * - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—É—Ä—Å–æ–≤
   * - –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —É—Ä–æ–∫–∏
   * - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—Ä–æ–∫–∏
   * - –£–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ—Å—Ç–∞–º–∏
   * - –£–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–¥–∞–Ω–∏—è–º–∏
   */
  // import courseManager from './courseManager.js';
  const adminPanel = {
    show() {
      const adminInterface = window.adminInterface;
      if (adminInterface) {
        adminInterface.show();
      } else {
        console.error('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
      }
    },
    hide() {
      const adminInterface = window.adminInterface;
      if (adminInterface) {
        adminInterface.hide();
      } else {
        console.error('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
      }
    },
    init() {
      document.addEventListener('keydown', (e) => {
        if (e.altKey && e.shiftKey && e.key === 'A') {
          this.show();
        }
      });
      console.log('–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ Alt+Shift+A');
      this.addUIControlsStyles();
      this.addUIToggleButton();
    },
    addUIControlsStyles() {
      const style = document.createElement('style');
      style.textContent = `
        .ui-controls-container {
          display: inline-block;
          margin-left: 10px;
        }
        .ui-controls-toggle {
          background-color: rgba(52, 152, 219, 0.8);
          color: white;
          border: none;
          border-radius: 4px;
          padding: 8px 12px;
          cursor: pointer;
          font-size: 14px;
          display: flex;
          align-items: center;
          transition: all 0.3s ease;
        }
        .ui-controls-toggle i {
          margin-right: 5px;
        }
        .ui-controls-toggle:hover {
          background-color: rgba(52, 152, 219, 1);
        }
        .ui-controls-toggle.controls-hidden {
          background-color: rgba(231, 76, 60, 0.8);
        }
        .ui-controls-toggle.controls-hidden:hover {
          background-color: rgba(231, 76, 60, 1);
        }
        .admin-toggle-hidden, .dev-mode-toggle-hidden {
          display: none !important;
        }
        @media (max-width: 768px) {
          .ui-controls-toggle span {
            display: none;
          }
          .ui-controls-toggle i {
            margin-right: 0;
          }
          .ui-controls-toggle {
            padding: 8px;
          }
        }
        .admin-header-actions {
          display: flex;
          align-items: center;
        }
      `;
      document.head.appendChild(style);
    },
    addUIToggleButton() {
      const toggleContainer = document.createElement('div');
      toggleContainer.id = 'ui-controls-container';
      toggleContainer.className = 'ui-controls-container';
      const toggleButton = document.createElement('button');
      toggleButton.id = 'ui-controls-toggle';
      toggleButton.className = 'ui-controls-toggle';
      toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i> <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º</span>';
      toggleButton.title = '–°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è';
      toggleContainer.appendChild(toggleButton);
      toggleButton.addEventListener('click', function() {
        const adminToggle = document.getElementById('admin-toggle');
        const devModeToggle = document.getElementById('dev-mode-toggle');
        if (adminToggle) {
          adminToggle.classList.toggle('admin-toggle-hidden');
        }
        if (devModeToggle) {
          devModeToggle.classList.toggle('dev-mode-toggle-hidden');
        }
        if ((adminToggle && adminToggle.classList.contains('admin-toggle-hidden')) || 
            (devModeToggle && devModeToggle.classList.contains('dev-mode-toggle-hidden'))) {
          toggleButton.innerHTML = '<i class="fas fa-eye"></i> <span>–ü–æ–∫–∞–∑–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</span>';
          toggleButton.classList.add('controls-hidden');
          toggleButton.title = '–ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è';
        } else {
          toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i> <span>–°–∫—Ä—ã—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</span>';
          toggleButton.classList.remove('controls-hidden');
          toggleButton.title = '–°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è';
        }
      });
      const addButtonToAdminPanel = () => {
        const adminHeaderActions = document.querySelector('.admin-header-actions');
        if (adminHeaderActions) {
          adminHeaderActions.appendChild(toggleContainer);
          console.log('–ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å');
        } else {
          document.body.appendChild(toggleContainer);
          console.log('–ù–µ –Ω–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä admin-header-actions, –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ body');
        }
      };
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(addButtonToAdminPanel, 500);
      } else {
        window.addEventListener('load', () => {
          setTimeout(addButtonToAdminPanel, 500);
        });
      }
    }
  };

  document.addEventListener('DOMContentLoaded', () => {
    adminPanel.init();
    window.setTimeout(() => {
      const adminPanelButton = document.querySelector('[onclick="openAdminPanel()"]');
      if (adminPanelButton) {
        adminPanelButton.id = 'admin-toggle';
      }
    }, 500);
  });
  window.adminPanel = adminPanel;
  window.openAdminPanel = function() {
    adminPanel.show();
  };
  // ==================== END ADMIN CODE ====================
  // ==================== BEGIN APP CODE ====================
  // –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ courseManager, devMode –∏ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏) adminInterface —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã

  // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ–∫—Ü–∏–π
  const homeContainer = document.getElementById('home');
  const guideContainer = document.getElementById('guide');
  const daySelectionContainer = document.getElementById('day-selection');
  const taskSelectionContainer = document.getElementById('task-selection');
  const dayHeader = document.getElementById('day-header');
  const taskButtonsDiv = document.getElementById('task-buttons');
  const professionSelect = document.getElementById('profession-select');
  const guideTitle = document.getElementById('guide-title');
  const loadingSpinner = document.getElementById('loading-spinner');
  const markdownContent = document.getElementById('markdown-content');
  const testButton = document.getElementById('test-button');

  // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
  function updateLoadingStatus(message, isError = false) {
    const statusElement = document.querySelector('.loading-status');
    if (statusElement) {
      statusElement.textContent = message;
      if (isError) {
        statusElement.style.color = '#ff5555';
        statusElement.style.fontWeight = 'bold';
      } else {
        statusElement.style.color = '';
        statusElement.style.fontWeight = '';
      }
    }
    console.log('–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏:', message);
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤
  async function autoImportWebhooks() {
    console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤...');
    const webhookSettingsStr = localStorage.getItem('webhookSettings');
    if (!webhookSettingsStr) {
      console.log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
      const defaultWebhookSettings = {
        exportUrl: 'https://auto.crm-s.com/webhook/SaveWebhooks',
        importUrl: 'https://auto.crm-s.com/webhook/OnboardingJSON',
        getUrl: 'https://auto.crm-s.com/webhook/GetOnboardingHooks'
      };
      localStorage.setItem('webhookSettings', JSON.stringify(defaultWebhookSettings));
      localStorage.setItem('adminExportWebhook', defaultWebhookSettings.exportUrl);
      localStorage.setItem('adminImportWebhook', defaultWebhookSettings.importUrl);
      localStorage.setItem('adminGetWebhook', defaultWebhookSettings.getUrl);
      console.log('–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:');
      console.log('- Import URL:', defaultWebhookSettings.importUrl);
      console.log('- Export URL:', defaultWebhookSettings.exportUrl);
      console.log('- Get URL:', defaultWebhookSettings.getUrl);
      if (window.adminInterface && typeof window.adminInterface.loadWebhookSettings === 'function') {
        window.adminInterface.loadWebhookSettings();
      }
      await importWebhooksFromServer(defaultWebhookSettings.getUrl);
      return defaultWebhookSettings;
    }
    try {
      const settings = JSON.parse(webhookSettingsStr);
      let updated = false;
      if (!settings.importUrl) {
        settings.importUrl = 'https://auto.crm-s.com/webhook/OnboardingJSON';
        localStorage.setItem('adminImportWebhook', settings.importUrl);
        updated = true;
      }
      if (!settings.exportUrl) {
        settings.exportUrl = 'https://auto.crm-s.com/webhook/SaveWebhooks';
        localStorage.setItem('adminExportWebhook', settings.exportUrl);
        updated = true;
      }
      if (!settings.getUrl) {
        settings.getUrl = 'https://auto.crm-s.com/webhook-test/GetOnboardingHooks';
        localStorage.setItem('adminGetWebhook', settings.getUrl);
        updated = true;
      }
      if (updated) {
        localStorage.setItem('webhookSettings', JSON.stringify(settings));
        console.log('–û–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤');
      } else {
        console.log('–ù–∞–π–¥–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤');
      }
      await importWebhooksFromServer(settings.getUrl);
      return settings;
    } catch (e) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤:', e);
      return null;
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤–µ–±—Ö—É–∫–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
  async function importWebhooksFromServer(url) {
    if (!url) {
      console.log('URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ–±—Ö—É–∫–æ–≤ –Ω–µ —É–∫–∞–∑–∞–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–º–ø–æ—Ä—Ç');
      return;
    }
    console.log(`–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –≤–µ–±—Ö—É–∫–æ–≤ —Å URL: ${url}`);
    updateLoadingStatus('–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤...');
    try {
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Accept': 'application/json, text/plain, */*',
          'Cache-Control': 'no-cache'
        },
        cache: 'no-store'
      });
      if (!response.ok) {
        throw new Error(`HTTP –æ—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
      }
      const responseText = await response.text();
      console.log(`–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç —Å –≤–µ–±—Ö—É–∫–∞–º–∏ (${responseText.length} —Å–∏–º–≤–æ–ª–æ–≤)`);
      try {
        const jsonData = JSON.parse(responseText);
        processWebhooksData(jsonData);
        updateLoadingStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
        return true;
      } catch (jsonError) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ JSON —Å –≤–µ–±—Ö—É–∫–∞–º–∏:', jsonError);
        const jsonRegex = /{[\s\S]*}/;
        const match = responseText.match(jsonRegex);
        if (match && match[0]) {
          try {
            const extractedData = JSON.parse(match[0]);
            processWebhooksData(extractedData);
            updateLoadingStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞');
            return true;
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ JSON –∏–∑ —Ç–µ–∫—Å—Ç–∞:', e);
          }
        }
        const urlRegex = /(https?:\/\/[^\s"]+)/g;
        const urls = responseText.match(urlRegex);
        if (urls && urls.length > 0) {
          console.log(`–ù–∞–π–¥–µ–Ω–æ ${urls.length} URL –≤ –æ—Ç–≤–µ—Ç–µ`);
          if (urls.length > 0) {
            localStorage.setItem('adminImportWebhook', urls[0]);
            console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞: ${urls[0]}`);
            const settings = JSON.parse(localStorage.getItem('webhookSettings') || '{}');
            settings.importUrl = urls[0];
            localStorage.setItem('webhookSettings', JSON.stringify(settings));
            updateLoadingStatus('URL –∏–º–ø–æ—Ä—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞');
            return true;
          }
        }
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤–µ–±—Ö—É–∫–æ–≤:', error);
      updateLoadingStatus(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤–µ–±—Ö—É–∫–æ–≤: ${error.message}`);
      return false;
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤
  function processWebhooksData(data) {
    try {
      console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤:', Object.keys(data));
      let updated = false;
      let settings = JSON.parse(localStorage.getItem('webhookSettings') || '{}');
      if (data.webhooks && Array.isArray(data.webhooks)) {
        console.log(`–ù–∞–π–¥–µ–Ω–æ ${data.webhooks.length} –≤–µ–±—Ö—É–∫–æ–≤ –≤ –º–∞—Å—Å–∏–≤–µ webhooks`);
        for (const webhook of data.webhooks) {
          if (webhook.url) {
            if (webhook.type === 'export' || webhook.id === 'export_courses_hook') {
              settings.exportUrl = webhook.url;
              localStorage.setItem('adminExportWebhook', webhook.url);
              console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL —ç–∫—Å–ø–æ—Ä—Ç–∞: ${webhook.url}`);
              updated = true;
            } else if (webhook.type === 'import' || webhook.id === 'import_courses_hook') {
              settings.importUrl = webhook.url;
              localStorage.setItem('adminImportWebhook', webhook.url);
              localStorage.setItem('importWebhookUrl', webhook.url);
              console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL –∏–º–ø–æ—Ä—Ç–∞: ${webhook.url}`);
              updated = true;
            } else if (webhook.type === 'notification' || webhook.id === 'notify_updates_hook') {
              settings.getUrl = webhook.url;
              localStorage.setItem('adminGetWebhook', webhook.url);
              console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ–±—Ö—É–∫–æ–≤: ${webhook.url}`);
              updated = true;
            }
          }
        }
      }
      if (data.exportUrl) {
        settings.exportUrl = data.exportUrl;
        localStorage.setItem('adminExportWebhook', data.exportUrl);
        console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL —ç–∫—Å–ø–æ—Ä—Ç–∞: ${data.exportUrl}`);
        updated = true;
      }
      if (data.importUrl) {
        settings.importUrl = data.importUrl;
        localStorage.setItem('adminImportWebhook', data.importUrl);
        localStorage.setItem('importWebhookUrl', data.importUrl);
        console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL –∏–º–ø–æ—Ä—Ç–∞: ${data.importUrl}`);
        updated = true;
      }
      if (data.getWebhooksUrl) {
        settings.getUrl = data.getWebhooksUrl;
        localStorage.setItem('adminGetWebhook', data.getWebhooksUrl);
        console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ–±—Ö—É–∫–æ–≤: ${data.getWebhooksUrl}`);
        updated = true;
      }
      const foundUrls = findUrlsInObject(data);
      if (foundUrls.length > 0) {
        console.log(`–ù–∞–π–¥–µ–Ω–æ ${foundUrls.length} URL-–∞–¥—Ä–µ—Å–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö`);
        foundUrls.forEach(urlInfo => {
          if (urlInfo.type === 'export') {
            settings.exportUrl = urlInfo.url;
            localStorage.setItem('adminExportWebhook', urlInfo.url);
            console.log(`–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL —ç–∫—Å–ø–æ—Ä—Ç–∞: ${urlInfo.url}`);
            updated = true;
          } else if (urlInfo.type === 'import') {
            settings.importUrl = urlInfo.url;
            localStorage.setItem('adminImportWebhook', urlInfo.url);
            localStorage.setItem('importWebhookUrl', urlInfo.url);
            console.log(`–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL –∏–º–ø–æ—Ä—Ç–∞: ${urlInfo.url}`);
            updated = true;
          } else if (urlInfo.type === 'get') {
            settings.getUrl = urlInfo.url;
            localStorage.setItem('adminGetWebhook', urlInfo.url);
            console.log(`–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω URL –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ–±—Ö—É–∫–æ–≤: ${urlInfo.url}`);
            updated = true;
          }
        });
      }
      if (updated) {
        localStorage.setItem('webhookSettings', JSON.stringify(settings));
        console.log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
        if (window.adminInterface && typeof window.adminInterface.loadWebhookSettings === 'function') {
          window.adminInterface.loadWebhookSettings();
        }
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤:', error);
    }
  }

  // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ URL –≤ –æ–±—ä–µ–∫—Ç–µ
  function findUrlsInObject(obj, path = '', results = []) {
    if (!obj || typeof obj !== 'object') return results;
    for (const key in obj) {
      if (Object.prototype.hasOwnProperty.call(obj, key)) {
        const value = obj[key];
        const currentPath = path ? `${path}.${key}` : key;
        if (typeof value === 'string' && isValidUrl(value)) {
          let type = 'unknown';
          if (key.toLowerCase().includes('export') || value.toLowerCase().includes('export') ||
              key.toLowerCase().includes('save') || value.toLowerCase().includes('save')) {
            type = 'export';
          } else if (key.toLowerCase().includes('import') || value.toLowerCase().includes('import') ||
                    key.toLowerCase().includes('get') || value.toLowerCase().includes('get')) {
            type = 'import';
          } else if (key.toLowerCase().includes('webhook') || value.toLowerCase().includes('webhook') ||
                    key.toLowerCase().includes('notification') || value.toLowerCase().includes('notification')) {
            type = 'get';
          }
          results.push({
            url: value,
            path: currentPath,
            type: type
          });
        } else if (typeof value === 'object' && value !== null) {
          findUrlsInObject(value, currentPath, results);
        }
      }
    }
    return results;
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ URL
  function isValidUrl(url) {
    try {
      new URL(url);
      return true;
    } catch (e) {
      return false;
    }
  }

  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise)
  async function forceSyncWithCloud() {
    return new Promise(async (resolve, reject) => {
      console.log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º...');
      updateLoadingStatus('–ü–æ–∏—Å–∫ URL –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö...');
      await autoImportWebhooks();
      const webhookSettingsStr = localStorage.getItem('webhookSettings');
      let importWebhookUrl = null;
      if (webhookSettingsStr) {
        try {
          const webhookSettings = JSON.parse(webhookSettingsStr);
          if (webhookSettings.importUrl) {
            importWebhookUrl = webhookSettings.importUrl;
            console.log(`–ù–∞–π–¥–µ–Ω URL –∏–º–ø–æ—Ä—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–µ–±—Ö—É–∫–æ–≤: ${importWebhookUrl}`);
            updateLoadingStatus(`–ù–∞–π–¥–µ–Ω URL –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–µ–±—Ö—É–∫–æ–≤`);
          }
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤:', e);
          updateLoadingStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–æ–≤');
        }
      }
      if (!importWebhookUrl) {
        importWebhookUrl = localStorage.getItem('adminImportWebhook') || localStorage.getItem('importWebhookUrl') || localStorage.getItem('testImportUrl');
      }
      if (importWebhookUrl) {
        if (window.devMode && window.devMode.enabled) {
          console.log('üîß [DevMode] –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º');
          console.log(`üîß [DevMode] URL –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞: ${importWebhookUrl}`);
        }
        try {
          updateLoadingStatus(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ ${importWebhookUrl.split('/').slice(-1)[0]}`);
          console.log(`–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö —Å URL: ${importWebhookUrl}`);
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 15000);
          try {
            const response = await fetch(importWebhookUrl, {
              method: 'GET',
              headers: {
                'Accept': 'application/json, text/plain, */*',
                'Content-Type': 'application/json',
                'Cache-Control': 'no-cache',
                'Pragma': 'no-cache'
              },
              cache: 'no-store',
              mode: 'cors',
              credentials: 'omit',
              signal: controller.signal
            });
            clearTimeout(timeoutId);
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }
            updateLoadingStatus('–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
            const responseText = await response.text();
            console.log(`–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, —Ä–∞–∑–º–µ—Ä: ${responseText.length} –±–∞–π—Ç`);
            try {
              let importData;
              console.log('Raw response:', JSON.stringify(responseText));
              if (!responseText || responseText.length < 10) {
                if (responseText && (responseText.trim() === 'Accepted' || responseText.trim() === 'OK' || responseText.trim().startsWith('Success'))) {
                  console.log('–ü–æ–ª—É—á–µ–Ω –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', responseText.trim());
                  return resolve({success: true, updated: false, message: `–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª: ${responseText.trim()}`});
                }
              }
              try {
                updateLoadingStatus('–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON...');
                try {
                  importData = JSON.parse(responseText.trim());
                  console.log('–£—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω JSON –∏–∑ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞');
                } catch (initialParseError) {
                  const trimmedText = responseText.trim();
                  if (trimmedText.startsWith('{') || trimmedText.startsWith('[')) {
                    try {
                      importData = JSON.parse(trimmedText);
                      console.log('–£—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ –ø–æ—Å–ª–µ –æ–±—Ä–µ–∑–∫–∏');
                    } catch (e) {
                      throw initialParseError;
                    }
                  } else {
                    throw new Error('–û—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç JSON –Ω–∞–ø—Ä—è–º—É—é, –ø–æ–∏—Å–∫ JSON –≤–Ω—É—Ç—Ä–∏ –æ—Ç–≤–µ—Ç–∞');
                  }
                }
              } catch (jsonError) {
                updateLoadingStatus('–ü–æ–∏—Å–∫ JSON –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ...');
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç –∫–∞–∫ JSON, –∏—â–µ–º JSON –≤ —Ç–µ–∫—Å—Ç–µ:', jsonError.message);
                const jsonRegex = /{[\s\S]*}/;
                const match = responseText.match(jsonRegex);
                if (match && match[0]) {
                  try {
                    importData = JSON.parse(match[0]);
                    console.log('–ù–∞–π–¥–µ–Ω –∏ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω JSON –≤ —Ç–µ–∫—Å—Ç–µ –æ—Ç–≤–µ—Ç–∞');
                  } catch (nestedError) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ JSON:', nestedError.message);
                    if (responseText.length < 100) {
                      console.log('–ü–æ–ª—É—á–µ–Ω –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç, —Å—á–∏—Ç–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —É—Å–ø–µ—à–Ω–æ–π');
                      return resolve({success: true, updated: false, message: `–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª: ${responseText.substring(0, 50)}`});
                    }
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–π JSON');
                  }
                } else {
                  if (responseText.trim().length > 0 && responseText.trim().length < 100) {
                    console.log('–ü–æ–ª—É—á–µ–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ JSON, —Å—á–∏—Ç–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —É—Å–ø–µ—à–Ω–æ–π');
                    return resolve({success: true, updated: false, message: `–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª: ${responseText.substring(0, 50)}`});
                  }
                  throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞');
                }
              }
              let coursesData = null;
              if (importData.courses) {
                coursesData = importData.courses;
                console.log('–ù–∞–π–¥–µ–Ω—ã –∫—É—Ä—Å—ã –≤ –ø–æ–ª–µ courses');
              } else if (importData.data) {
                if (typeof importData.data === 'object') {
                  coursesData = importData.data;
                  console.log('–ù–∞–π–¥–µ–Ω—ã –∫—É—Ä—Å—ã –≤ –ø–æ–ª–µ data (–æ–±—ä–µ–∫—Ç)');
                } else if (typeof importData.data === 'string') {
                  try {
                    const parsedData = JSON.parse(importData.data);
                    coursesData = parsedData.courses || parsedData;
                    console.log('–ù–∞–π–¥–µ–Ω—ã –∫—É—Ä—Å—ã –≤ –ø–æ–ª–µ data (JSON —Å—Ç—Ä–æ–∫–∞)');
                  } catch (e) {
                    console.log(`–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –≤ –ø–æ–ª–µ data: ${e.message}`);
                  }
                }
              } else if (importData.content && typeof importData.content === 'object') {
                coursesData = importData.content;
                console.log('–ù–∞–π–¥–µ–Ω—ã –∫—É—Ä—Å—ã –≤ –ø–æ–ª–µ content (–æ–±—ä–µ–∫—Ç)');
              } else if (typeof importData === 'object') {
                const hasValidStructure = Object.values(importData).some(value => {
                  return value && typeof value === 'object' && 
                        (value.days || value.specialLessons || value.title || value.redirectUrl || value.noDayLessons);
                });
                if (hasValidStructure) {
                  coursesData = importData;
                  console.log('–ö–æ—Ä–Ω–µ–≤–æ–π –æ–±—ä–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—É—Ä—Å–æ–≤');
                }
              }
              if (coursesData) {
                const isValid = validateCoursesStructure(coursesData);
                if (!isValid) {
                  console.error('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤');
                  return resolve({success: false, error: '–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö'});
                }
                const forceUpdate = !courseManager.courses;
                const currentCoursesJson = JSON.stringify(courseManager.courses || {});
                const newCoursesJson = JSON.stringify(coursesData);
                if (forceUpdate || currentCoursesJson !== newCoursesJson) {
                  console.log(forceUpdate 
                    ? '–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤' 
                    : '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–∏–º–µ–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –æ–±–ª–∞–∫–∞');
                  if (courseManager.courses) {
                    localStorage.setItem('coursesBackup', currentCoursesJson);
                    localStorage.setItem('coursesBackupTimestamp', new Date().toISOString());
                  }
                  cacheWebhookUrls(coursesData);
                  updateLoadingStatus('–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫—É—Ä—Å–æ–≤...');
                  applyCoursesConfig(coursesData);
                  console.log('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±–Ω–æ–≤–ª–µ–Ω');
                  updateLoadingStatus('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                  return resolve({success: true, updated: true, data: coursesData});
                } else {
                  console.log('–î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è');
                  updateLoadingStatus('–î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è');
                  return resolve({success: true, updated: false});
                }
              } else {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ –æ –∫—É—Ä—Å–∞—Ö –≤ –æ—Ç–≤–µ—Ç–µ');
                return resolve({success: false, error: '–î–∞–Ω–Ω—ã–µ –æ –∫—É—Ä—Å–∞—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'});
              }
            } catch (fetchError) {
              clearTimeout(timeoutId);
              console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', fetchError);
              updateLoadingStatus(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ${fetchError.message}`);
              const backupDataStr = localStorage.getItem('coursesBackup');
              if (backupDataStr) {
                try {
                  console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏');
                  console.log('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –æ—Ç:', localStorage.getItem('coursesBackupTimestamp'));
                  const backupData = JSON.parse(backupDataStr);
                  courseManager.courses = backupData;
                  return resolve({success: true, updated: false, fromBackup: true});
                } catch (backupError) {
                  console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', backupError);
                }
              }
              if (fetchError.name === 'AbortError') {
                return resolve({success: false, error: '–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞'});
              } else {
                return resolve({success: false, error: fetchError.message});
              }
            }
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', e);
            updateLoadingStatus(`–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ${e.message}`);
            const backupDataStr = localStorage.getItem('coursesBackup');
            if (backupDataStr) {
              try {
                const backupData = JSON.parse(backupDataStr);
                courseManager.courses = backupData;
                return resolve({success: true, updated: false, fromBackup: true});
              } catch (backupError) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', backupError);
                return reject(e);
              }
            } else {
              return reject(e);
            }
          }
        } else {
          console.log('URL –≤–µ–±—Ö—É–∫–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é');
          const backupDataStr = localStorage.getItem('coursesBackup');
          if (backupDataStr) {
            try {
              console.log('URL –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é');
              const backupData = JSON.parse(backupDataStr);
              courseManager.courses = backupData;
              return resolve({success: true, updated: false, fromBackup: true});
            } catch (backupError) {
              console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', backupError);
            }
          }
          updateLoadingStatus('URL –≤–µ–±—Ö—É–∫–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
          return resolve({success: false, error: 'URL –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω'});
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –æ–±–ª–∞–∫–æ–º:', error);
        if (error.name === 'AbortError') {
          console.error('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (—Ç–∞–π–º–∞—É—Ç)');
          return resolve({success: false, error: '–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞'});
        }
        return resolve({success: false, error: error.message});
      }
    });
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤
  function validateCoursesStructure(coursesData) {
    if (!coursesData || typeof coursesData !== 'object') {
      return false;
    }
    const courseKeys = Object.keys(coursesData);
    return courseKeys.length > 0 && 
      courseKeys.some(key => {
        const course = coursesData[key];
        return course && typeof course === 'object' && 
               (course.days || course.specialLessons || course.redirectUrl || course.noDayLessons);
      });
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö URL –≤–µ–±—Ö—É–∫–æ–≤ –∏–∑ —É—Ä–æ–∫–æ–≤
  function cacheWebhookUrls(coursesData) {
    const webhookUrls = {};
    Object.keys(coursesData).forEach(professionId => {
      const course = coursesData[professionId];
      if (course.days && Array.isArray(course.days)) {
        course.days.forEach(day => {
          if (day.lessons && Array.isArray(day.lessons)) {
            day.lessons.forEach(lesson => {
              if (lesson.contentSource && lesson.contentSource.type === 'webhook' && lesson.contentSource.url) {
                const key = `${professionId}_${day.id}_${lesson.id}`;
                webhookUrls[key] = lesson.contentSource.url;
              }
            });
          }
        });
      }
      if (course.specialLessons && Array.isArray(course.specialLessons)) {
        course.specialLessons.forEach(lesson => {
          if (lesson.contentSource && lesson.contentSource.type === 'webhook' && lesson.contentSource.url) {
            const key = `${professionId}_special_${lesson.id}`;
            webhookUrls[key] = lesson.contentSource.url;
          }
        });
      }
      if (course.noDayLessons && Array.isArray(course.noDayLessons)) {
        course.noDayLessons.forEach(lesson => {
          if (lesson.contentSource && lesson.contentSource.type === 'webhook' && lesson.contentSource.url) {
            const key = `${professionId}_noday_${lesson.id}`;
            webhookUrls[key] = lesson.contentSource.url;
          }
        });
      }
    });
    localStorage.setItem('webhookUrlsCache', JSON.stringify(webhookUrls));
    if (window.devMode && window.devMode.enabled) {
      console.log(`üîß [DevMode] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ ${Object.keys(webhookUrls).length} URL –≤–µ–±—Ö—É–∫–æ–≤ –¥–ª—è —É—Ä–æ–∫–æ–≤`);
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫—É—Ä—Å–æ–≤
  function applyCoursesConfig(coursesData) {
    console.log('–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫—É—Ä—Å–æ–≤ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é');
    if (window.devMode && window.devMode.enabled) {
      console.log('üîß [DevMode] –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫—É—Ä—Å–æ–≤ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é');
    }
    const currentProfession = courseManager.currentProfession;
    const currentDayId = courseManager.currentDay ? courseManager.currentDay.id : null;
    const currentLessonId = courseManager.currentLesson ? courseManager.currentLesson.id : null;
    if (window.devMode && window.devMode.enabled) {
      let webhookCount = 0;
      Object.values(coursesData).forEach(course => {
        if (course.days && Array.isArray(course.days)) {
          course.days.forEach(day => {
            if (day.lessons && Array.isArray(day.lessons)) {
              day.lessons.forEach(lesson => {
                if (lesson.contentSource && lesson.contentSource.type === 'webhook') {
                  webhookCount++;
                  console.log(`üîß [DevMode] –í–µ–±—Ö—É–∫ –≤ —É—Ä–æ–∫–µ ${lesson.id}: ${lesson.contentSource.url}`);
                }
              });
            }
          });
        }
      });
      console.log(`üîß [DevMode] –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ ${webhookCount} –≤–µ–±—Ö—É–∫–æ–≤ –≤ —É—Ä–æ–∫–∞—Ö`);
    }
    courseManager.courses = coursesData;
    console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫—É—Ä—Å–æ–≤');
    courseManager.notifyCoursesUpdated();
    console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π');
    updateProfessionSelector();
    if (!coursesData[currentProfession]) {
      const professions = Object.keys(coursesData);
      if (professions.length > 0) {
        const newProfession = professions[0];
        console.log(`–¢–µ–∫—É—â–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è ${currentProfession} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ ${newProfession}`);
        courseManager.switchProfession(newProfession);
      } else {
        console.error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–π –≤ –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏');
        return;
      }
    } else {
      console.log(`–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é: ${currentProfession}`);
      courseManager.switchProfession(currentProfession);
    }
    console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–Ω–µ–π');
    updateDaysList();
    if (currentDayId) {
      const dayFound = courseManager.selectDay(currentDayId);
      if (dayFound) {
        console.log(`–í—ã–±—Ä–∞–Ω –¥–µ–Ω—å —Å ID: ${currentDayId}`);
        updateLessonsList();
        if (currentLessonId) {
          const lessonFound = courseManager.selectLesson(currentLessonId);
          if (lessonFound) {
            console.log(`–í—ã–±—Ä–∞–Ω —É—Ä–æ–∫ —Å ID: ${currentLessonId}`);
            if (document.getElementById('guide').classList.contains('hidden') === false) {
              console.log('–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞');
              loadLessonContent();
            }
          } else {
            console.log(`–£—Ä–æ–∫ —Å ID ${currentLessonId} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏`);
          }
        }
      } else {
        console.log(`–î–µ–Ω—å —Å ID ${currentDayId} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏`);
      }
    }
    console.log('–î–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ–≤ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ JSON');
    if (document.getElementById('home').classList.contains('hidden') === false) {
      console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
      renderHomePage();
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π
  function updateProfessionSelector() {
    const professionSelect = document.getElementById('profession-select');
    if (!professionSelect) return;
    const currentValue = professionSelect.value;
    const professions = courseManager.getProfessions();
    professionSelect.innerHTML = '';
    professions.forEach(professionId => {
      const course = courseManager.courses[professionId];
      const option = document.createElement('option');
      option.value = professionId;
      option.textContent = course.title || professionId;
      professionSelect.appendChild(option);
    });
    if (professions.includes(currentValue)) {
      professionSelect.value = currentValue;
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥–Ω–µ–π
  function updateDaysList() {
    const daySelectionContainer = document.getElementById('day-selection');
    if (!daySelectionContainer) return;
    let dayCardsContainer = daySelectionContainer.querySelector('.content-cards');
    if (!dayCardsContainer) {
      dayCardsContainer = document.createElement('div');
      dayCardsContainer.className = 'content-cards';
      daySelectionContainer.appendChild(dayCardsContainer);
    }
    dayCardsContainer.innerHTML = '';
    const daysTitle = document.createElement('h2');
    daysTitle.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å –æ–±—É—á–µ–Ω–∏—è:';
    dayCardsContainer.appendChild(daysTitle);
    const days = courseManager.getDays();
    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${days.length} –¥–Ω–µ–π –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ${courseManager.currentProfession}`);
    days.forEach(day => {
      const card = document.createElement('div');
      card.className = 'course-card';
      card.innerHTML = `
        <h3>${day.title || `–î–µ–Ω—å ${day.id}`}</h3>
        <p>${day.description || '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —É—Ä–æ–∫–∏'}</p>
      `;
      card.onclick = () => selectDay(day.id);
      dayCardsContainer.appendChild(card);
    });
    if (days.length === 0) {
      const emptyMessage = document.createElement('p');
      emptyMessage.textContent = '–î–ª—è —ç—Ç–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–Ω–∏ –æ–±—É—á–µ–Ω–∏—è.';
      dayCardsContainer.appendChild(emptyMessage);
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —É—Ä–æ–∫–æ–≤
  function updateLessonsList() {
    if (!courseManager.currentDay) {
      console.log('–ù–µ –≤—ã–±—Ä–∞–Ω —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Ä–æ–∫–æ–≤');
      return;
    }
    const taskButtonsDiv = document.getElementById('task-buttons');
    if (!taskButtonsDiv) {
      console.error('–ù–µ –Ω–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É—Ä–æ–∫–æ–≤ (task-buttons)');
      return;
    }
    taskButtonsDiv.innerHTML = '';
    try {
      const lessons = courseManager.getLessonsForCurrentDay();
      if (!lessons || !Array.isArray(lessons)) {
        console.error('–ü–æ–ª—É—á–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—Ä–æ–∫–æ–≤:', lessons);
        const errorMessage = document.createElement('p');
        errorMessage.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
        errorMessage.className = 'error-message';
        errorMessage.style.color = '#ff5555';
        taskButtonsDiv.appendChild(errorMessage);
        return;
      }
      console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${lessons.length} —É—Ä–æ–∫–æ–≤ –¥–ª—è –¥–Ω—è ${courseManager.currentDay.id}`);
      if (lessons.length === 0) {
        const emptyMessage = document.createElement('p');
        emptyMessage.textContent = '–î–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã —É—Ä–æ–∫–∏.';
        emptyMessage.className = 'empty-message';
        taskButtonsDiv.appendChild(emptyMessage);
        return;
      }
      lessons.forEach(lesson => {
        const btn = document.createElement('button');
        btn.innerText = lesson.title || `–£—Ä–æ–∫ ${lesson.id}`;
        btn.onclick = function() { selectLesson(lesson.id); };
        if (lesson.description) {
          const description = document.createElement('small');
          description.textContent = lesson.description;
          description.style.display = 'block';
          description.style.marginTop = '5px';
          description.style.color = '#666';
          btn.appendChild(description);
        }
        taskButtonsDiv.appendChild(btn);
      });
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —É—Ä–æ–∫–æ–≤:', error);
      const errorMessage = document.createElement('p');
      errorMessage.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —É—Ä–æ–∫–æ–≤.';
      errorMessage.className = 'error-message';
      errorMessage.style.color = '#ff5555';
      taskButtonsDiv.appendChild(errorMessage);
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  function renderHomePage() {
    if (!courseManager.courses || Object.keys(courseManager.courses).length === 0) {
      console.error('–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –¥–æ–º–∞—à–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É');
      updateLoadingStatus('–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', true);
      return;
    }
    console.log('–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏:', Object.keys(courseManager.courses));
    updateProfessionSelector();
    if (courseManager.currentProfession) {
      updateDaysList();
      updateVocabularyButton();
    }
    showSection('home');
    daySelectionContainer.classList.remove('hidden');
    taskSelectionContainer.classList.add('hidden');
  }

  // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–º–µ–Ω—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
  function handleProfessionChange() {
    const selectedProfession = professionSelect.value;
    if (courseManager.hasRedirect(selectedProfession)) {
      const redirectUrl = courseManager.getRedirectUrl(selectedProfession);
      if (redirectUrl) {
        console.log(`–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤–Ω–µ—à–Ω–∏–π —Ä–µ—Å—É—Ä—Å: ${redirectUrl}`);
        window.location.href = redirectUrl;
        return;
      }
    }
    console.log(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é: ${selectedProfession}`);
    courseManager.switchProfession(selectedProfession);
    updateDaysList();
    courseManager.currentLesson = null;
    showSection('home');
    daySelectionContainer.classList.remove('hidden');
    taskSelectionContainer.classList.add('hidden');
    updateVocabularyButton();
  }

  // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –¥–Ω—è –æ–±—É—á–µ–Ω–∏—è
  window.selectDay = function(dayId) {
    const day = courseManager.selectDay(dayId);
    if (!day) {
      console.error(`–î–µ–Ω—å —Å ID ${dayId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
      return;
    }
    dayHeader.innerText = day.title || `–î–µ–Ω—å ${day.id}`;
    daySelectionContainer.classList.add('hidden');
    taskSelectionContainer.classList.remove('hidden');
    updateLessonsList();
  };

  // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —É—Ä–æ–∫–∞
  window.selectLesson = function(lessonId) {
    const lesson = courseManager.selectLesson(lessonId);
    if (!lesson) {
      console.error(`–£—Ä–æ–∫ —Å ID ${lessonId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
      alert(`–£—Ä–æ–∫ —Å ID ${lessonId} –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —É—Ä–æ–∫.`);
      return;
    }
    console.log(`–í—ã–±—Ä–∞–Ω —É—Ä–æ–∫: ${lesson.title} (ID: ${lesson.id})`);
    if (lesson.contentSource) {
      console.log(`–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${lesson.contentSource.type}`);
      if (lesson.contentSource.type === 'webhook') {
        console.log(`URL –≤–µ–±—Ö—É–∫–∞: ${lesson.contentSource.url}`);
        const cacheKey = `${courseManager.currentProfession}_${courseManager.currentDay ? courseManager.currentDay.id : 'special'}_${lesson.id}`;
        const cachedUrl = getCachedWebhookUrl(cacheKey);
        if (cachedUrl && cachedUrl !== lesson.contentSource.url) {
          console.log(`–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ URL –≤–µ–±—Ö—É–∫–∞ –¥–ª—è —É—Ä–æ–∫–∞ ${lesson.id}`);
          console.log(`–ü—Ä–µ–¥—ã–¥—É—â–∏–π URL: ${cachedUrl}`);
          console.log(`–ù–æ–≤—ã–π URL: ${lesson.contentSource.url}`);
        }
      }
    } else {
      console.warn(`–£—Ä–æ–∫ ${lessonId} –Ω–µ –∏–º–µ–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞`);
    }
    guideTitle.innerText = `Guide: ${lesson.title || `–£—Ä–æ–∫ ${lesson.id}`}`;
    hideAllAudio();
    if (lesson.testSource) {
      testButton.classList.remove('hidden');
      testButton.onclick = function() { openTest(lesson); };
    } else {
      testButton.classList.add('hidden');
    }
    const audioInfo = courseManager.getAudioInfo();
    if (audioInfo) {
      console.log('–ù–∞–π–¥–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞—É–¥–∏–æ –¥–ª—è —É—Ä–æ–∫–∞:', lesson.id);
      console.log('–ê—É–¥–∏–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:', JSON.stringify(audioInfo));
      showAudioForLesson(lesson);
    } else {
      console.log('–î–ª—è —É—Ä–æ–∫–∞', lesson.id, '–∞—É–¥–∏–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
    }
    function showAudioForLesson(lesson) {
      hideAllAudio();
      if (!lesson) return;
      if (!lesson.audioSource && lesson.audio) {
        lesson.audioSource = lesson.audio;
        console.log('–ü—Ä–∏—Å–≤–æ–µ–Ω–æ audioSource –∏–∑ lesson.audio');
      }
      if (!lesson.audioSource) {
        console.log('–£ —É—Ä–æ–∫–∞ –Ω–µ—Ç –∞—É–¥–∏–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞');
        return;
      }
      console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ –¥–ª—è —É—Ä–æ–∫–∞:', lesson.id, '–¢–∏–ø –∞—É–¥–∏–æ:', lesson.audioSource.type);
      console.log('–î–∞–Ω–Ω—ã–µ –∞—É–¥–∏–æ:', JSON.stringify(lesson.audioSource));
      const audioType = (lesson.audioSource.type || '').toLowerCase();
      const audioEmbed = document.getElementById('audio-embed');
      if (!audioEmbed) {
        console.warn('–≠–ª–µ–º–µ–Ω—Ç —Å id "audio-embed" –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTML-—Ä–∞–∑–º–µ—Ç–∫—É.');
        return;
      }
      let embedContent = '';
      if (audioType === 'soundcloud') {
        if (lesson.audioSource.trackUrl) {
          embedContent = `<iframe src="${lesson.audioSource.trackUrl}" width="100%" height="166" frameborder="0" allow="autoplay"></iframe>`;
        } else if (lesson.audioSource.url) {
          embedContent = `<iframe src="${lesson.audioSource.url}" width="100%" height="166" frameborder="0" allow="autoplay"></iframe>`;
        } else if (lesson.audioSource.embedCode) {
          embedContent = lesson.audioSource.embedCode;
        } else if (lesson.audioSource.embed) {
          embedContent = lesson.audioSource.embed;
        }
      } else if (audioType === 'url' && lesson.audioSource.url) {
        embedContent = `<audio controls style="width:100%; max-width:600px;">
          <source src="${lesson.audioSource.url}" type="audio/mpeg">
          –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
        </audio>`;
      } else if (audioType === 'embed' && lesson.audioSource.embedCode) {
        embedContent = lesson.audioSource.embedCode;
      } else if (lesson.audioSource.url) {
        embedContent = `<audio controls style="width:100%; max-width:600px;">
          <source src="${lesson.audioSource.url}" type="audio/mpeg">
          –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
        </audio>`;
      }
      if (!embedContent) {
        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å embedContent –∏–∑ audioSource:", lesson.audioSource);
        audioEmbed.innerHTML = "<p>Audio not available</p>";
        return;
      }
      audioEmbed.innerHTML = embedContent;
      audioEmbed.classList.remove('hidden');
      console.log('–ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º');
    }
    showSection('guide');
    const contentSpinner = document.getElementById('content-loading-spinner');
    if (contentSpinner) contentSpinner.classList.remove('hidden');
    loadLessonContent();
  };

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ URL –≤–µ–±—Ö—É–∫–∞ –ø–æ –∫–ª—é—á—É
  function getCachedWebhookUrl(key) {
    try {
      const cacheStr = localStorage.getItem('webhookUrlsCache');
      if (cacheStr) {
        const cache = JSON.parse(cacheStr);
        return cache[key];
      }
    } catch (e) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ URL –≤–µ–±—Ö—É–∫–∞:', e);
    }
    return null;
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–∞ –¥–ª—è —É—Ä–æ–∫–∞
  async function loadTestForLesson(lesson) {
    try {
      if (!lesson.day && courseManager.currentDay) {
        lesson.day = courseManager.currentDay.id;
      }
      if (!lesson.courseId && courseManager.currentProfession) {
        lesson.courseId = courseManager.currentProfession;
      }
      const testContent = await courseManager.fetchTest(lesson);
      if (!testContent) {
        alert('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');
        return;
      }
      window.quizData = testContent;
      startQuiz();
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Å—Ç–∞:', error);
      alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Å—Ç–∞: ' + error.message);
    }
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
  function openTest(lesson) {
    if (lesson.testSource && lesson.testSource.url) {
      loadTestForLesson(lesson);
    }
  }

  // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ iframe (quiz.html)
  function startQuiz() {
    let quizFrame = document.getElementById('quiz-frame');
    if (!quizFrame) {
      quizFrame = document.createElement('iframe');
      quizFrame.id = 'quiz-frame';
      quizFrame.style.border = 'none';
      quizFrame.style.width = '100%';
      quizFrame.style.height = '100vh';
      quizFrame.style.position = 'fixed';
      quizFrame.style.top = '0';
      quizFrame.style.left = '0';
      quizFrame.style.zIndex = '9999';
      quizFrame.style.backgroundColor = '#f8f9fa';
      document.body.appendChild(quizFrame);
      const closeButton = document.createElement('button');
      closeButton.innerText = '–ó–∞–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç';
      closeButton.style.position = 'fixed';
      closeButton.style.top = '10px';
      closeButton.style.right = '10px';
      closeButton.style.zIndex = '10000';
      closeButton.style.padding = '8px 15px';
      closeButton.style.border = 'none';
      closeButton.style.borderRadius = '5px';
      closeButton.style.backgroundColor = '#e74c3c';
      closeButton.style.color = 'white';
      closeButton.style.cursor = 'pointer';
      closeButton.onclick = function() {
        document.getElementById('quiz-frame').style.display = 'none';
        document.body.removeChild(closeButton);
      };
      document.body.appendChild(closeButton);
    } else {
      quizFrame.style.display = 'block';
    }
    quizFrame.src = 'quiz.html';
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞
  async function loadLessonContent() {
    const contentSpinner = document.getElementById('content-loading-spinner');
    if (contentSpinner) contentSpinner.classList.remove('hidden');
    markdownContent.classList.add('hidden');
    const globalLoadingOverlay = document.getElementById('global-loading-overlay');
    if (globalLoadingOverlay) {
      globalLoadingOverlay.style.display = 'flex';
      globalLoadingOverlay.style.opacity = '1';
      const globalStatusElement = document.getElementById('global-loading-status');
      if (globalStatusElement) {
        globalStatusElement.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞...';
      }
    }
    try {
      if (!courseManager.currentLesson) {
        throw new Error('–ù–µ –≤—ã–±—Ä–∞–Ω —É—Ä–æ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏');
      }
      console.log('–ó–∞–ø—Ä–æ—Å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —É—Ä–æ–∫–∞:', courseManager.currentLesson.id);
      const content = await courseManager.fetchLessonContent();
      if (!content) {
        throw new Error('–ü–æ–ª—É—á–µ–Ω –ø—É—Å—Ç–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç');
      }
      console.log(`–ü–æ–ª—É—á–µ–Ω –∫–æ–Ω—Ç–µ–Ω—Ç (${content.length} —Å–∏–º–≤–æ–ª–æ–≤), —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...`);
      let processedContent = content;
      if (!content.trim().startsWith('#')) {
        processedContent = `# ${courseManager.currentLesson.title || '–£—Ä–æ–∫'}\n\n${content}`;
      }
      const formattedHTML = createCollapsibleBlocks(processedContent);
      console.log('–ö–æ–Ω—Ç–µ–Ω—Ç –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ...');
      markdownContent.innerHTML = formattedHTML;
      const task = courseManager.getTask();
      if (task) {
        console.log('–ù–∞–π–¥–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —É—Ä–æ–∫–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç');
        const taskHTML = marked.parse(task);
        const taskSection = document.createElement('div');
        taskSection.className = 'task-section';
        taskSection.innerHTML = `
          <h2>Practical Task</h2>
          <div class="task-content">${taskHTML}</div>
        `;
        markdownContent.appendChild(taskSection);
      }
      if (contentSpinner) contentSpinner.classList.add('hidden');
      markdownContent.classList.remove('hidden');
      if (globalLoadingOverlay) {
        globalLoadingOverlay.style.transition = 'opacity 0.5s';
        globalLoadingOverlay.style.opacity = '0';
        setTimeout(() => {
          globalLoadingOverlay.style.display = 'none';
        }, 500);
      }
      console.log('–ö–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω');
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞:', error);
      const lessonTitle = courseManager.currentLesson 
        ? (courseManager.currentLesson.title || `–£—Ä–æ–∫ ${courseManager.currentLesson.id}`)
        : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—Ä–æ–∫';
      markdownContent.innerHTML = `
        <div style="background-color: #fff0f0; padding: 15px; border-left: 4px solid #ff0000; margin-bottom: 20px;">
          <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞ "${lessonTitle}"</h3>
          <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –∫–æ–º–∞–Ω–¥—ã.</p>
          <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> ${error.message || error.toString()}</p>
          <div style="margin-top: 15px;">
            <button onclick="goBackToTaskSelection()" style="margin-right: 10px; background-color: #3498db; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer;">
              –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —É—Ä–æ–∫–æ–≤
            </button>
            <button onclick="loadLessonContent()" style="margin-right: 10px; background-color: #f39c12; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer;">
              –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
            </button>
            <button onclick="location.reload()" style="background-color: #4CAF50; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer;">
              –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
            </button>
          </div>
        </div>
      `;
      if (contentSpinner) contentSpinner.classList.add('hidden');
      markdownContent.classList.remove('hidden');
      if (globalLoadingOverlay) {
        globalLoadingOverlay.style.transition = 'opacity 0.5s';
        globalLoadingOverlay.style.opacity = '0';
        setTimeout(() => {
          globalLoadingOverlay.style.display = 'none';
        }, 500);
      }
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ª–æ–≤–∞—Ä—è
  window.openVocabulary = function() {
    selectLesson('vocabulary');
  };

  // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –≤—ã–±–æ—Ä—É –¥–Ω—è
  window.goBackToDaySelection = function() {
    taskSelectionContainer.classList.add('hidden');
    daySelectionContainer.classList.remove('hidden');
  };

  // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –≤—ã–±–æ—Ä—É –∑–∞–¥–∞–Ω–∏—è
  window.goBackToTaskSelection = function() {
    hideAllAudio();
    markdownContent.innerHTML = '';
    courseManager.currentLesson = null;
    homeContainer.classList.remove('hidden');
    if (courseManager.currentDay) {
      selectDay(courseManager.currentDay.id);
    }
    guideContainer.classList.add('hidden');
  };

  // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö –∞—É–¥–∏–æ
  function hideAllAudio() {
    const audioEmbed = document.getElementById("audio-embed");
    if (audioEmbed) {
      audioEmbed.classList.add("hidden");
      audioEmbed.innerHTML = '';
    }
    const legacyContainers = [
      "audio-first-lesson",
      "audio-vocabulary"
    ];
    legacyContainers.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.classList.add("hidden");
      }
    });
    const audioContainers = document.querySelectorAll('.audio-container');
    if (audioContainers.length > 0) {
      audioContainers.forEach(container => {
        container.classList.add('hidden');
      });
      console.log(`–°–∫—Ä—ã—Ç–æ ${audioContainers.length} –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤`);
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–µ–∫—Ü–∏–∏
  function showSection(id) {
    homeContainer.classList.add('hidden');
    guideContainer.classList.add('hidden');
    const target = document.getElementById(id);
    if (target) target.classList.remove('hidden');
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è –±–ª–æ–∫–æ–≤ –∏–∑ markdown
  function createCollapsibleBlocks(markdown) {
    markdown = markdown.trim();
    const lines = markdown.split("\n");
    let htmlOutput = "";
    let currentLevel1Title = "";
    let currentLevel1Content = [];
    let inLevel1 = false;
    if (lines.length > 0 && !lines[0].match(/^#\s+/)) {
      lines.unshift("# " + (window.currentTopic ? window.currentTopic.title : "Content"));
    }
    for (let line of lines) {
      let match = line.match(/^#(?!#)\s*(.+)/);
      if (match) {
        if (inLevel1) {
          htmlOutput += renderLevel1Block(currentLevel1Title, currentLevel1Content.join("\n"));
        }
        currentLevel1Title = match[1].trim();
        currentLevel1Content = [];
        inLevel1 = true;
      } else {
        if (inLevel1) {
          currentLevel1Content.push(line);
        }
      }
    }
    if (inLevel1) {
      htmlOutput += renderLevel1Block(currentLevel1Title, currentLevel1Content.join("\n"));
    } else if (!htmlOutput) {
      htmlOutput = marked.parse(markdown);
    }
    return htmlOutput;
  }

  function renderLevel1Block(title, content) {
    const lines = content.split("\n");
    let html = "";
    let subBlocksHtml = "";
    let currentSubTitle = "";
    let currentSubContent = [];
    let hasSubHeader = false;
    let preambleLines = [];
    for (let line of lines) {
      let subMatch = line.match(/^##(?!#)\s*(.+)/);
      if (subMatch) {
        hasSubHeader = true;
        if (currentSubTitle) {
          subBlocksHtml += renderLevel2Block(currentSubTitle, currentSubContent.join("\n"));
          currentSubContent = [];
        }
        currentSubTitle = subMatch[1].trim();
      } else {
        if (hasSubHeader) {
          currentSubContent.push(line);
        } else {
          preambleLines.push(line);
        }
      }
    }
    if (currentSubTitle) {
      subBlocksHtml += renderLevel2Block(currentSubTitle, currentSubContent.join("\n"));
    }
    if (preambleLines.length) {
      html += marked.parse(preambleLines.join("\n"));
    }
    html += subBlocksHtml;
    return `<details>
    <summary>${title}</summary>
    <div>${html}</div>
  </details>`;
  }

  function renderLevel2Block(title, content) {
    const lines = content.split("\n");
    let html = "";
    let subBlocksHtml = "";
    let currentSubTitle = "";
    let currentSubContent = [];
    let hasSubHeader = false;
    let preambleLines = [];
    for (let line of lines) {
      let subMatch = line.match(/^###(?!#)\s*(.+)/);
      if (subMatch) {
        hasSubHeader = true;
        if (currentSubTitle) {
          subBlocksHtml += renderLevel3Block(currentSubTitle, currentSubContent.join("\n"));
          currentSubContent = [];
        }
        currentSubTitle = subMatch[1].trim();
      } else {
        if (hasSubHeader) {
          currentSubContent.push(line);
        } else {
          preambleLines.push(line);
        }
      }
    }
    if (currentSubTitle) {
      subBlocksHtml += renderLevel3Block(currentSubTitle, currentSubContent.join("\n"));
    }
    if (preambleLines.length) {
      html += marked.parse(preambleLines.join("\n"));
    }
    html += subBlocksHtml;
    return `<details style="margin-left:20px;">
    <summary>${title}</summary>
    <div>${html}</div>
  </details>`;
  }

  function renderLevel3Block(title, content) {
    let parsedContent = marked.parse(content);
    return `<details style="margin-left:40px;">
    <summary>${title}</summary>
    <div>${parsedContent}</div>
  </details>`;
  }

  // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
  window.openAdminPanel = function() {
    window.location.href = 'admin.html';
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  document.addEventListener('DOMContentLoaded', initApp);

  // ==================== END APP CODE ====================


  // ==================== BEGIN FETCH TESTS CODE ====================
  // –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –≤–µ–±—Ö—É–∫–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ö –≤ JSON

  async function fetchTests() {
    console.log('Starting to fetch test data from webhooks...');
    const courseManager = window.courseManager || {};
    const courses = courseManager.courses || {};
    const testData = {};
    for (const courseId in courses) {
      const course = courses[courseId];
      testData[courseId] = { 
        title: course.title || courseId,
        days: [] 
      };
      if (course.days && Array.isArray(course.days)) {
        for (const day of course.days) {
          const dayData = {
            id: day.id,
            title: day.title || `Day ${day.id}`,
            lessons: []
          };
          if (day.lessons && Array.isArray(day.lessons)) {
            for (const lesson of day.lessons) {
              if (lesson.testSource && lesson.testSource.url) {
                console.log(`Found test webhook for lesson ${lesson.id}: ${lesson.testSource.url}`);
                try {
                  const testContent = await fetchTestContent(lesson.testSource.url);
                  dayData.lessons.push({
                    id: lesson.id,
                    title: lesson.title,
                    testData: testContent
                  });
                } catch (error) {
                  console.error(`Error fetching test for ${lesson.id}:`, error);
                  dayData.lessons.push({
                    id: lesson.id,
                    title: lesson.title,
                    testData: null,
                    error: error.message
                  });
                }
              } else {
                dayData.lessons.push({
                  id: lesson.id,
                  title: lesson.title,
                  testData: null
                });
              }
            }
          }
          testData[courseId].days.push(dayData);
        }
      }
      if (course.specialLessons && Array.isArray(course.specialLessons)) {
        if (!testData[courseId].specialLessons) {
          testData[courseId].specialLessons = [];
        }
        for (const lesson of course.specialLessons) {
          if (lesson.testSource && lesson.testSource.url) {
            console.log(`Found test webhook for special lesson ${lesson.id}: ${lesson.testSource.url}`);
            try {
              const testContent = await fetchTestContent(lesson.testSource.url);
              testData[courseId].specialLessons.push({
                id: lesson.id,
                title: lesson.title,
                testData: testContent
              });
            } catch (error) {
              console.error(`Error fetching test for special lesson ${lesson.id}:`, error);
              testData[courseId].specialLessons.push({
                id: lesson.id,
                title: lesson.title,
                testData: null,
                error: error.message
              });
            }
          } else {
            testData[courseId].specialLessons.push({
              id: lesson.id,
              title: lesson.title,
              testData: null
            });
          }
        }
      }
    }
    saveTestsToFile(testData);
    return testData;
  }

  async function fetchTestContent(url) {
    console.log(`Fetching test data from: ${url}`);
    try {
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Accept': 'application/json, text/plain, */*',
          'Content-Type': 'application/json',
          'Cache-Control': 'no-cache'
        },
        cache: 'no-store',
        mode: 'cors',
        credentials: 'omit'
      });
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      const responseText = await response.text();
      console.log(`Received response from ${url}, length: ${responseText.length} bytes`);
      try {
        const data = JSON.parse(responseText);
        return processTestData(data);
      } catch (jsonError) {
        console.log('Response is not JSON, trying to parse as HTML or extract JSON from text');
        const jsonMatch = responseText.match(/{[\s\S]*}/);
        if (jsonMatch && jsonMatch[0]) {
          try {
            const extractedData = JSON.parse(jsonMatch[0]);
            return processTestData(extractedData);
          } catch (e) {
            console.error('Failed to extract JSON from text response');
          }
        }
        if (responseText.includes('<!DOCTYPE html>') || responseText.includes('<html>')) {
          return extractTestFromHTML(responseText);
        }
        return {
          rawContent: responseText,
          format: 'text',
          parsed: false
        };
      }
    } catch (error) {
      console.error(`Error fetching test content from ${url}:`, error);
      throw error;
    }
  }

  function processTestData(data) {
    if (data.questions) {
      return {
        name: data.name || data.title || 'Unnamed Test',
        description: data.description || '',
        questions: data.questions.map(q => ({
          question: q.question || q.text || '',
          options: q.options || q.answers || [],
          correctAnswer: q.correctAnswer || q.correct || q.correct_answer || '',
          points: q.points || 1
        })),
        format: 'json',
        parsed: true,
        task: data.task || null
      };
    } else if (data.test && data.test.questions) {
      return {
        name: data.test.name || data.test.title || 'Unnamed Test',
        description: data.test.description || '',
        questions: data.test.questions.map(q => ({
          question: q.question || q.text || '',
          options: q.options || q.answers || [],
          correctAnswer: q.correctAnswer || q.correct || q.correct_answer || '',
          points: q.points || 1
        })),
        format: 'json',
        parsed: true,
        task: data.test.task || data.task || null
      };
    } else if (Array.isArray(data)) {
      return {
        name: 'Unnamed Test',
        description: '',
        questions: data.map(q => ({
          question: q.question || q.text || '',
          options: q.options || q.answers || [],
          correctAnswer: q.correctAnswer || q.correct || q.correct_answer || '',
          points: q.points || 1
        })),
        format: 'json',
        parsed: true
      };
    }
    return {
      rawData: data,
      format: 'json',
      parsed: false
    };
  }

  function extractTestFromHTML(html) {
    const testData = {
      name: '',
      description: '',
      questions: [],
      format: 'html',
      parsed: false
    };
    const titleMatch = html.match(/<title>(.*?)<\/title>/);
    if (titleMatch && titleMatch[1]) {
      testData.name = titleMatch[1].trim();
    }
    const questionRegex = /<div class="question"[^>]*data-points="(\d+)"[^>]*>\s*<h3>(.*?)<\/h3>([\s\S]*?)<\/div>/g;
    let match;
    while ((match = questionRegex.exec(html)) !== null) {
      const points = parseInt(match[1]) || 1;
      const questionText = match[2].replace(/<[^>]*>/g, '').trim();
      const optionsHTML = match[3];
      const options = [];
      let correctAnswer = '';
      const optionRegex = /<label><input type="radio" name="[^"]*" value="([^"]*)"(?:\s+data-correct="([^"]*)")?\s*>\s*(.*?)<\/label>/g;
      let optionMatch;
      while ((optionMatch = optionRegex.exec(optionsHTML)) !== null) {
        const value = optionMatch[1];
        const isCorrect = optionMatch[2] === 'true';
        const text = optionMatch[3].replace(/<[^>]*>/g, '').trim();
        options.push({ value, text });
        if (isCorrect) {
          correctAnswer = value;
        }
      }
      testData.questions.push({
        question: questionText,
        options,
        correctAnswer,
        points
      });
    }
    testData.parsed = testData.questions.length > 0;
    return testData;
  }

  function saveTestsToFile(data) {
    const jsonData = JSON.stringify(data, null, 2);
    function saveToFileSystem(content, filename) {
      try {
        if (window.fetch) {
          try {
            fetch('/save-tests', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ content, filename })
            })
            .then(response => response.text())
            .then(result => {
              console.log('Server save result:', result);
            })
            .catch(error => {
              console.error('Error saving via server:', error);
            });
          } catch (e) {
            console.error('Error trying to save via server:', e);
          }
        }
      } catch (error) {
        console.error('Error preparing file for download:', error);
      }
    }
    saveToFileSystem(jsonData, 'tests.json');
    console.log('Tests data prepared for server save');
  }

  // –ó–∞–ø—É—Å–∫ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ courseManager
  if (typeof window !== 'undefined') {
    let waitCount = 0;
    const maxWaits = 30;
    function waitForCourseManager() {
      if (window.courseManager && window.courseManager.courses) {
        fetchTests().then(testData => {
          console.log('Test data fetch complete, data saved');
          window.testData = testData;
        });
      } else {
        waitCount++;
        if (waitCount <= maxWaits) {
          console.log(`Waiting for courseManager to be initialized... (${waitCount}/${maxWaits})`);
          setTimeout(waitForCourseManager, 1000);
        } else {
          console.warn('Exceeded maximum wait time for courseManager. Aborting test data fetch.');
        }
      }
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(waitForCourseManager, 3000);
      });
    } else {
      setTimeout(waitForCourseManager, 3000);
    }
  }

  // ==================== END FETCH TESTS CODE ====================
  </script>
  </body>
  </html>